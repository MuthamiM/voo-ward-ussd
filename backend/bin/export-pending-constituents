#!/usr/bin/env node
const { Client } = require('pg');
const fs = require('fs');

(async () => {
  const db = new Client({
    connectionString: process.env.DB_URL || 'postgresql://localhost/voo_ward'
  });
  await db.connect();
  
  try {
    const res = await db.query(
      'SELECT id_no_last4, name, village, verification_status FROM constituents WHERE verification_status = ',
      ['pending']
    );
    
    console.log('id_no_last4,name,village,status');
    res.rows.forEach(r => {
      console.log([\"$\{r.id_no_last4\}"\, \"$\{r.name\}"\, \"$\{r.village\}"\, r.verification_status].join(','));
    });
    process.exit(0);
  } catch(err) {
    console.error(err);
    process.exit(1);
  } finally {
    await db.end();
  }
})();
