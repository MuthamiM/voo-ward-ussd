<!DOCTYPE html>
<!-- VERSION: 2025-11-24-FIX-LOGIN-v2 - Force browser refresh -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" type="image/svg+xml" href="/favicon.ico">
    <title>VOO Ward - Modern Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #06b6d4;
            --accent: #f59e0b;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --surface: rgba(255, 255, 255, 0.05);
            --surface-hover: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);
            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --blur: blur(20px);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 25%, #2d1b69 50%, #4c1d95 75%, #6366f1 100%);
            min-height: 100vh;
            color: var(--text);
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            z-index: -1;
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(1deg); }
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: var(--blur);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.1) 0%, transparent 100%);
            pointer-events: none;
        }

        .sidebar-header {
            padding: 32px 24px;
            border-bottom: 1px solid var(--border);
            position: relative;
            z-index: 2;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 20px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            transform: translateX(-100%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 20px;
            line-height: 1.2;
            background: linear-gradient(135deg, var(--text) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-subtitle {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* Navigation */
        .nav {
            flex: 1;
            padding: 24px 0;
            position: relative;
            z-index: 2;
        }

        .nav-section {
            margin-bottom: 32px;
        }

        .nav-title {
            padding: 0 24px 16px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-item {
            position: relative;
            margin: 0 16px 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            border-radius: 16px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 16px;
        }

        .nav-link:hover::before,
        .nav-link.active::before {
            opacity: 0.1;
        }

        .nav-link:hover {
            color: var(--text);
            transform: translateX(4px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.2);
        }

        .nav-link.active {
            color: var(--text);
            background: rgba(99, 102, 241, 0.1);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.2);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            position: relative;
            z-index: 1;
        }

        .nav-text {
            position: relative;
            z-index: 1;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: var(--blur);
            border-bottom: 1px solid var(--border);
            padding: 24px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .page-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-muted);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .search-box {
            position: relative;
            width: 320px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 48px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px 8px 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .dropdown-item:hover {
            background: rgba(99, 102, 241, 0.15) !important;
            color: #fff !important;
            border-color: rgba(99, 102, 241, 0.3) !important;
            transform: translateX(2px);
        }
        
        .profile-dropdown {
            animation: dropdownFadeIn 0.3s ease;
        }
        
        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
        }

        .user-role {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            position: relative;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: var(--blur);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 28px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            position: relative;
        }

        .stat-icon.primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .stat-icon.success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        }

        .stat-icon.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
        }

        .stat-icon.secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #0891b2 100%);
        }

        .stat-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 36px;
            font-weight: 800;
            line-height: 1;
            position: relative;
            z-index: 2;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
            position: relative;
            z-index: 2;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 12px;
            position: relative;
            z-index: 2;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--error);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: var(--blur);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            position: relative;
            overflow: hidden;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .card-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 20px;
            font-weight: 700;
        }

        .card-action {
            padding: 8px 16px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 8px;
            color: var(--primary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .card-action:hover {
            background: rgba(99, 102, 241, 0.2);
        }

        /* Activity List */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .activity-description {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .activity-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .search-box {
                width: 240px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                transform: translateX(-100%);
            }
            
            .header {
                padding: 16px 20px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .search-box {
                display: none;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Smooth scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Login Form */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: inherit;
            z-index: 1000;
        }

        .login-card {
            width: 400px;
            max-width: 90vw;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: var(--blur);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 48px 40px;
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, transparent 100%);
        }

        .login-header {
            text-align: center;
            margin-bottom: 32px;
            position: relative;
            z-index: 2;
        }

        .login-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 24px;
            position: relative;
            z-index: 2;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.btn-full {
            width: 100%;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid var(--border);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h3 {
            margin: 0;
            color: var(--text);
            font-size: 20px;
            font-weight: 600;
        }

        .modal-header button {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .modal-header button:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 0;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 24px 16px;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h3 {
            margin: 0;
            color: var(--text);
            font-size: 20px;
            font-weight: 600;
        }

        .modal-header button {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            line-height: 1;
            transition: color 0.3s;
        }

        .modal-header button:hover {
            color: var(--error);
        }

        .modal form {
            padding: 24px;
        }

        .modal .form-group {
            margin-bottom: 20px;
        }

        .modal .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text);
            font-weight: 500;
        }

        .modal input, 
        .modal select, 
        .modal textarea {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s;
        }

        .modal input:focus, 
        .modal select:focus, 
        .modal textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.1);
        }

        .modal textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .modal-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-actions .btn {
            background: var(--primary);
            color: white;
        }

        .modal-actions .btn:hover {
            background: var(--primary-dark);
        }

        .modal-actions .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .modal-actions .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <div class="login-card" style="background: var(--surface); padding: 48px 40px; border-radius: 24px; box-shadow: var(--shadow-elevated); border: 1px solid var(--border); max-width: 420px; width: 100%; margin: 0 24px; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;">
            <div class="login-header" style="text-align: center; margin-bottom: 32px; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;">
                <h1 class="login-title" style="font-family: 'Space Grotesk', sans-serif; font-size: 32px; font-weight: 700; color: var(--text); margin-bottom: 8px; text-align: center; letter-spacing: -0.5px; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;">Welcome Back</h1>
                <p class="login-subtitle" style="color: var(--text-secondary); font-size: 16px; margin: 0; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;">Sign in to VOO Ward Admin Dashboard</p>
            </div>
            
            <form id="loginForm">
                <div id="loginError"></div>
                
                <div class="form-group">
                    <label class="form-label" for="username">Username</label>
                    <input type="text" id="username" class="form-input" placeholder="Enter your username" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <input type="password" id="password" class="form-input" placeholder="Enter your password" required>
                </div>
                
                <button type="button" class="btn btn-full" id="loginBtn" onclick="handleLogin(event); return false;">
                    <span>Sign In</span>
                </button>
                
                <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <p style="color: var(--text-secondary); margin-bottom: 10px;">Don't have an account?</p>
                    <a href="signup.html" style="color: var(--primary); text-decoration: none; font-weight: 500; padding: 8px 16px; border: 1px solid var(--primary); border-radius: 6px; display: inline-block; transition: all 0.3s ease;">
                        Create New Account
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" class="app-container" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">VK</div>
                    <div class="logo-text">
                        <div class="logo-title">VOO Ward</div>
                        <div class="logo-subtitle">Admin Dashboard</div>
                    </div>
                </div>
            </div>
            
            <nav class="nav">
                <div class="nav-section">
                    <div class="nav-title">Main</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link active" data-page="dashboard" onclick="handleNavigation(event)">
                            <i class="nav-icon fas fa-home"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-page="issues" onclick="handleNavigation(event)">
                            <i class="nav-icon fas fa-exclamation-circle"></i>
                            <span class="nav-text">Issues</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-page="bursaries" onclick="handleNavigation(event)">
                            <i class="nav-icon fas fa-graduation-cap"></i>
                            <span class="nav-text">Bursaries</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-page="constituents" onclick="handleNavigation(event)">
                            <i class="nav-icon fas fa-users"></i>
                            <span class="nav-text">Constituents</span>
                        </a>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Communication</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-page="announcements" onclick="handleNavigation(event)">
                            <i class="nav-icon fas fa-bullhorn"></i>
                            <span class="nav-text">Announcements</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-page="ussd" onclick="handleNavigation(event)">
                            <i class="nav-icon fas fa-mobile-alt"></i>
                            <span class="nav-text">USSD Interactions</span>
                        </a>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Management</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-page="settings" onclick="handleNavigation(event)">
                            <i class="nav-icon fas fa-cog"></i>
                            <span class="nav-text">Settings</span>
                        </a>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <div>
                        <h1 class="page-title" id="pageTitle">Dashboard</h1>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <i class="fas fa-chevron-right"></i>
                            <span id="breadcrumbCurrent">Dashboard</span>
                        </div>
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="search-box">
                        <i class="search-icon fas fa-search"></i>
                        <input type="text" class="search-input" placeholder="Search anything...">
                    </div>
                    
                    <div class="user-profile" style="position: relative;">
                        <div class="user-avatar" id="userAvatar" onclick="toggleProfileDropdown()" style="width: 60px; height: 60px; cursor: pointer; border: 4px solid rgba(99,102,241,0.6); transition: all 0.3s ease; background: linear-gradient(135deg, #6366f1, #8b5cf6); background-size: cover; background-position: center; background-repeat: no-repeat; box-shadow: 0 6px 20px rgba(99,102,241,0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: 700; color: white; text-transform: uppercase;" onmouseover="this.style.borderColor='#6366f1'; this.style.transform='scale(1.15)'; this.style.boxShadow='0 8px 25px rgba(99,102,241,0.7)'" onmouseout="this.style.borderColor='rgba(99,102,241,0.6)'; this.style.transform='scale(1)'; this.style.boxShadow='0 6px 20px rgba(99,102,241,0.5)'">Z</div>
                    
                    <!-- Profile Dropdown Menu -->
                    <!-- Hidden file input for profile picture -->
                    <input type="file" id="profilePictureInput" accept="image/*" style="display: none;" onchange="uploadProfilePicture(this)">
                    
                    <!-- Profile Dropdown Menu: Now created dynamically by toggleProfileDropdown() function -->
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard Content -->
                <div id="dashboardContent" class="page-content">
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon primary">
                                    <i class="fas fa-exclamation-circle"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="totalIssues">0</div>
                            <div class="stat-label">Total Issues</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>12% from last month</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon success">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="totalBursaries">0</div>
                            <div class="stat-label">Bursaries Processed</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>8% from last month</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon secondary">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="totalConstituents">0</div>
                            <div class="stat-label">Registered Constituents</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>15% from last month</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon warning">
                                    <i class="fas fa-mobile-alt"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="totalUssd">0</div>
                            <div class="stat-label">USSD Interactions</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>23% from last month</span>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Grid -->
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h2 class="card-title">Recent Activity</h2>
                                <a href="#" class="card-action">View All</a>
                            </div>
                            <div class="activity-list" id="activityList">
                                <div class="activity-item">
                                    <div class="activity-icon success">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">Issue #2024-001 Resolved</div>
                                        <div class="activity-description">Water shortage complaint has been addressed</div>
                                    </div>
                                    <div class="activity-time">5 min ago</div>
                                </div>
                                
                                <div class="activity-item">
                                    <div class="activity-icon primary">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">New Bursary Application</div>
                                        <div class="activity-description">John Doe submitted application #BUR-2024-045</div>
                                    </div>
                                    <div class="activity-time">12 min ago</div>
                                </div>
                                
                                <div class="activity-item">
                                    <div class="activity-icon secondary">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">New Constituent Registration</div>
                                        <div class="activity-description">Mary Smith registered as a new constituent</div>
                                    </div>
                                    <div class="activity-time">25 min ago</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h2 class="card-title">Quick Actions</h2>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 16px;">
                                <button class="btn" onclick="showAddIssueModal()">
                                    <i class="fas fa-plus"></i>
                                    <span>Add New Issue</span>
                                </button>
                                
                                <button class="btn" onclick="showProcessBursaryModal()">
                                    <i class="fas fa-graduation-cap"></i>
                                    <span>Process Bursary</span>
                                </button>
                                
                                <button class="btn" onclick="showAnnouncementModal()">
                                    <i class="fas fa-bullhorn"></i>
                                    <span>Send Announcement</span>
                                </button>
                                
                                <button class="btn" onclick="event.preventDefault(); setActivePage('users'); showPageContent('users'); return false;" onmousedown="event.preventDefault(); setActivePage('users'); showPageContent('users'); return false;">
                                    <i class="fas fa-user-cog"></i>
                                    <span>Manage Users</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add more page contents as needed -->
                <div id="issuesContent" class="page-content" style="display: none;">
                    <div style="margin-bottom: 32px;">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h2 class="card-title">Constituent Issues Management</h2>
                                <p style="color: #ccc; margin: 8px 0; font-size: 14px;">Track and manage issues reported by constituents</p>
                                <div style="display: flex; gap: 12px;">
                                    <button class="btn" onclick="showAddIssueModal()" style="background: #059669; color: white;">
                                        <i class="fas fa-plus"></i>
                                        <span>Report New Issue</span>
                                    </button>
                                    <button class="btn" onclick="loadIssuesData()" style="background: rgba(255,255,255,0.1); color: #ccc;">
                                        <i class="fas fa-sync-alt"></i>
                                        <span>Refresh</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Issues Filter Bar -->
                            <div style="padding: 16px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                                <span style="color: #ccc; font-size: 14px; margin-right: 8px;">Filter by status:</span>
                                <button onclick="filterIssues('all')" class="status-filter active" data-status="all" style="padding: 6px 12px; background: rgba(99, 102, 241, 0.2); color: #6366f1; border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 6px; cursor: pointer; font-size: 12px;">All Issues</button>
                                <button onclick="filterIssues('pending')" class="status-filter" data-status="pending" style="padding: 6px 12px; background: rgba(245, 158, 11, 0.2); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 6px; cursor: pointer; font-size: 12px;">Pending</button>
                                <button onclick="filterIssues('in-progress')" class="status-filter" data-status="in-progress" style="padding: 6px 12px; background: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 6px; cursor: pointer; font-size: 12px;">In Progress</button>
                                <button onclick="filterIssues('resolved')" class="status-filter" data-status="resolved" style="padding: 6px 12px; background: rgba(5, 150, 105, 0.2); color: #059669; border: 1px solid rgba(5, 150, 105, 0.3); border-radius: 6px; cursor: pointer; font-size: 12px;">Resolved</button>
                                <button onclick="filterIssues('closed')" class="status-filter" data-status="closed" style="padding: 6px 12px; background: rgba(107, 114, 128, 0.2); color: #6b7280; border: 1px solid rgba(107, 114, 128, 0.3); border-radius: 6px; cursor: pointer; font-size: 12px;">Closed</button>
                            </div>
                            
                            <div id="issuesList" style="padding: 20px; min-height: 300px;">
                                <div class="loading" id="issuesLoading" style="text-align: center; color: #ccc; padding: 40px;">
                                    <div style="margin-bottom: 16px; font-size: 24px;">ðŸ“‹</div>
                                    <div>Loading constituent issues...</div>
                                    <div style="margin-top: 8px; font-size: 12px; opacity: 0.7;">Fetching reported issues from database</div>
                                </div>
                            </div>
                            
                            <div style="border-top: 1px solid rgba(255,255,255,0.1); padding: 16px 20px; color: #ccc; font-size: 14px; display: flex; justify-content: space-between; align-items: center;">
                                <span id="issuesCount">Loading...</span>
                                <div style="display: flex; gap: 16px; font-size: 12px;">
                                    <span style="color: #f59e0b;">â— Pending: <span id="pendingCount">0</span></span>
                                    <span style="color: #3b82f6;">â— In Progress: <span id="inProgressCount">0</span></span>
                                    <span style="color: #059669;">â— Resolved: <span id="resolvedCount">0</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="bursariesContent" class="page-content" style="display: none;">
                    <div style="margin-bottom: 32px;">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h2 class="card-title">Bursaries Management</h2>
                                <button class="btn" onclick="showProcessBursaryModal()">
                                    <i class="fas fa-graduation-cap"></i>
                                    <span>Process Application</span>
                                </button>
                            </div>
                            
                            <div id="bursariesList">
                                <div class="loading" id="bursariesLoading">Loading bursary applications...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="settingsContent" class="page-content" style="display: none;">
                    <div style="max-width: 800px;">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h2 class="card-title">Profile Settings</h2>
                            </div>
                            
                            <!-- Profile Picture Section -->
                            <div style="margin-bottom: 32px;">
                                <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">Profile Picture</h3>
                                <div style="display: flex; align-items: center; gap: 20px;">
                                    <div style="position: relative;">
                                        <img id="currentProfilePic" src="/uploads/avatars/default-avatar.png" alt="Profile" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--border); object-fit: cover; background: linear-gradient(135deg, var(--primary), var(--secondary));">
                                        <div id="uploadIndicator" style="position: absolute; bottom: 0; right: 0; width: 24px; height: 24px; background: var(--success); border-radius: 50%; border: 2px solid var(--surface); display: none; align-items: center; justify-content: center;">
                                            <i class="fas fa-check" style="color: white; font-size: 12px;"></i>
                                        </div>
                                    </div>
                                    <div style="flex: 1;">
                                        <input type="file" id="profilePictureInput" accept="image/*" style="display: none;" onchange="uploadProfilePicture(this)">
                                        <button class="btn" onclick="document.getElementById('profilePictureInput').click()" id="uploadProfileBtn">
                                            <i class="fas fa-upload"></i>
                                            <span>Upload New Picture</span>
                                        </button>
                                        <p style="margin-top: 8px; font-size: 14px; color: var(--text-secondary);">
                                            Supported formats: JPG, PNG, GIF. Max size: 5MB.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Account Information -->
                            <div style="margin-bottom: 32px;">
                                <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">Account Information</h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                    <div class="form-group">
                                        <label class="form-label">Full Name</label>
                                        <input type="text" id="fullNameInput" class="form-input" placeholder="Enter your full name">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email Address</label>
                                        <input type="email" id="emailInput" class="form-input" placeholder="Enter your email">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Phone Number</label>
                                        <input type="tel" id="phoneInput" class="form-input" placeholder="Enter your phone number">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Role</label>
                                        <input type="text" id="roleInput" class="form-input" readonly>
                                    </div>
                                </div>
                                <button class="btn" onclick="updateProfile()" id="updateProfileBtn" style="margin-top: 16px;">
                                    <i class="fas fa-save"></i>
                                    <span>Update Profile</span>
                                </button>
                            </div>

                            <!-- Password Change -->
                            <div style="margin-bottom: 32px;">
                                <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">Change Password</h3>
                                <div style="max-width: 400px;">
                                    <div class="form-group">
                                        <label class="form-label">Current Password</label>
                                        <input type="password" id="currentPassword" class="form-input" placeholder="Enter current password">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">New Password</label>
                                        <input type="password" id="newPassword" class="form-input" placeholder="Enter new password">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Confirm New Password</label>
                                        <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password">
                                    </div>
                                    <button class="btn" onclick="changePassword()" id="changePasswordBtn">
                                        <i class="fas fa-lock"></i>
                                        <span>Change Password</span>
                                    </button>
                                </div>
                            </div>

                            <!-- System Information -->
                            <div style="margin-bottom: 32px;">
                                <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">System Status</h3>
                                <div id="systemStatus" style="padding: 20px; background: rgba(255, 255, 255, 0.03); border-radius: 12px; border: 1px solid var(--border);">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                        <div id="dbStatusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: var(--warning);"></div>
                                        <span>Database Connectivity: <span id="dbStatusText">Checking...</span></span>
                                    </div>
                                    <button class="btn" onclick="refreshSystemStatus()" id="refreshStatusBtn" style="font-size: 14px; padding: 8px 16px;">
                                        <i class="fas fa-refresh"></i>
                                        <span>Refresh Status</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="announcementsContent" class="page-content" style="display: none;">
                    <div style="margin-bottom: 32px;">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h2 class="card-title">Ward Announcements</h2>
                                <button class="btn" onclick="showNewAnnouncementModal()">
                                    <i class="fas fa-plus"></i>
                                    <span>New Announcement</span>
                                </button>
                            </div>
                            
                            <div id="announcementsList" style="margin-top: 20px;">
                                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    <div class="loading"></div>
                                    <p style="margin-top: 16px;">Loading announcements...</p>
                                </div>
                            </div>
                        </div>

                        <!-- USSD News Preview -->
                        <div class="dashboard-card" style="margin-top: 32px;">
                            <div class="card-header">
                                <h2 class="card-title">USSD News Preview</h2>
                                <button class="btn" onclick="refreshNewsPreview()">
                                    <i class="fas fa-refresh"></i>
                                    <span>Refresh Preview</span>
                                </button>
                            </div>
                            
                            <div id="ussdNewsPreview" style="margin-top: 20px;">
                                <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">
                                    This shows how announcements and resolved issues appear in the USSD news feed:
                                </p>
                                <div style="background: rgba(0,0,0,0.2); padding: 16px; border-radius: 8px; font-family: monospace; white-space: pre-wrap; border: 1px solid var(--border);" id="ussdPreviewText">
                                    Loading preview...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Management Content -->
                <div id="usersContent" class="page-content" style="display: none;">
                    <div style="margin-bottom: 32px;">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h2 class="card-title">User Management</h2>
                                <p style="color: #ccc; margin: 8px 0; font-size: 14px;">Manage system users and their roles (MCA, Clerk, PA - Max 3 total)</p>
                                <div style="display: flex; gap: 12px;">
                                    <a href="signup.html" class="btn" style="background: #6366f1; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
                                        <i class="fas fa-user-plus"></i>
                                        <span>Add New User</span>
                                    </a>
                                    <button class="btn" onclick="loadUsersData()" style="background: rgba(255,255,255,0.1); color: #ccc; padding: 8px 16px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                                        <i class="fas fa-sync-alt"></i>
                                        <span>Refresh</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="usersList" style="padding: 20px; min-height: 200px;">
                                <div class="loading" id="usersLoading" style="text-align: center; color: #ccc; padding: 40px;">
                                    <div style="margin-bottom: 16px; font-size: 24px;">ðŸ‘¥</div>
                                    <div>Loading user data...</div>
                                    <div style="margin-top: 8px; font-size: 12px; opacity: 0.7;">Please wait while we fetch user information</div>
                                </div>
                            </div>
                            
                            <div style="border-top: 1px solid rgba(255,255,255,0.1); padding: 16px 20px; color: #ccc; font-size: 14px;">
                                <span id="usersCount">Loading...</span> users registered â€¢ Role-based access control active
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Constituents Content -->
                <div id="constituentsContent" class="page-content" style="display: none;">
                    <div style="margin-bottom: 32px;">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h2 class="card-title">Constituents Management</h2>
                                <button class="btn" onclick="exportConstituents()">
                                    <i class="fas fa-download"></i>
                                    <span>Export Data</span>
                                </button>
                            </div>
                            
                            <div id="constituentsList" style="padding: 20px;">
                                <div class="loading" id="constituentsLoading" style="text-align: center;">Loading constituents...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- USSD Interactions Content -->
                <div id="ussdContent" class="page-content" style="display: none;">
                    <div style="margin-bottom: 32px;">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h2 class="card-title">USSD Interactions</h2>
                                <button class="btn" onclick="refreshUssdData()">
                                    <i class="fas fa-refresh"></i>
                                    <span>Refresh Data</span>
                                </button>
                            </div>
                            
                            <div id="ussdList" style="padding: 20px;">
                                <div class="loading" id="ussdLoading" style="text-align: center;">Loading USSD interactions...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Issue Modal -->
    <div id="addIssueModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Issue</h3>
                <button onclick="closeModal('addIssueModal')">&times;</button>
            </div>
            <form id="addIssueForm" onsubmit="submitNewIssue(event)">
                <div class="form-group">
                    <label for="issueTitle">Issue Title</label>
                    <input type="text" id="issueTitle" required placeholder="Brief description of the issue">
                </div>
                <div class="form-group">
                    <label for="issueDescription">Description</label>
                    <textarea id="issueDescription" required placeholder="Detailed description of the issue" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="issuePriority">Priority</label>
                    <select id="issuePriority" required>
                        <option value="">Select Priority</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="issueLocation">Location</label>
                    <input type="text" id="issueLocation" placeholder="Location where the issue occurred">
                </div>
                <div class="modal-actions">
                    <button type="button" onclick="closeModal('addIssueModal')" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn">Add Issue</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Process Bursary Modal -->
    <div id="processBursaryModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Process Bursary Application</h3>
                <button onclick="closeModal('processBursaryModal')">&times;</button>
            </div>
            <form id="processBursaryForm" onsubmit="submitBursaryDecision(event)">
                <div class="form-group">
                    <label for="applicantName">Applicant Name</label>
                    <input type="text" id="applicantName" required placeholder="Full name of applicant">
                </div>
                <div class="form-group">
                    <label for="applicationId">Application ID</label>
                    <input type="text" id="applicationId" required placeholder="e.g., BUR-2024-045">
                </div>
                <div class="form-group">
                    <label for="bursaryAmount">Bursary Amount</label>
                    <input type="number" id="bursaryAmount" required placeholder="Amount in KES" min="0">
                </div>
                <div class="form-group">
                    <label for="bursaryDecision">Decision</label>
                    <select id="bursaryDecision" required>
                        <option value="">Select Decision</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                        <option value="pending">Pending Review</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="decisionReason">Reason/Notes</label>
                    <textarea id="decisionReason" placeholder="Reason for decision or additional notes" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" onclick="closeModal('processBursaryModal')" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn">Process Application</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Update Issue Status Modal -->
    <div id="updateIssueModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Issue Status</h3>
                <button onclick="closeModal('updateIssueModal')">&times;</button>
            </div>
            <form id="updateIssueForm" onsubmit="submitIssueUpdate(event)">
                <input type="hidden" id="updateIssueId">
                <div class="form-group">
                    <label for="issueTitle">Issue Title</label>
                    <input type="text" id="updateIssueTitle" readonly style="background: rgba(255,255,255,0.05);">
                </div>
                <div class="form-group">
                    <label for="issueStatus">Status</label>
                    <select id="issueStatus" required>
                        <option value="">Select Status</option>
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="resolved">Resolved</option>
                        <option value="closed">Closed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="issueActionNote">Action Note</label>
                    <textarea id="issueActionNote" placeholder="Enter notes about the action taken" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" onclick="closeModal('updateIssueModal')" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn">Update Status</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Send Announcement Modal -->
    <div id="announcementModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Send New Announcement</h3>
                <button onclick="closeModal('announcementModal')">&times;</button>
            </div>
            <form id="announcementForm" onsubmit="submitAnnouncement(event)">
                <div class="form-group">
                    <label for="announcementTitle">Announcement Title</label>
                    <input type="text" id="announcementTitle" required placeholder="Title for the announcement">
                </div>
                <div class="form-group">
                    <label for="announcementMessage">Message</label>
                    <textarea id="announcementMessage" required placeholder="Announcement message" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="announcementType">Type</label>
                    <select id="announcementType" required>
                        <option value="">Select Type</option>
                        <option value="general">General Information</option>
                        <option value="urgent">Urgent Notice</option>
                        <option value="event">Event Notification</option>
                        <option value="service">Service Update</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sendSMS" style="margin-right: 8px;">
                        Send as SMS notification
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="button" onclick="closeModal('announcementModal')" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn">Send Announcement</button>
                </div>
            </form>
        </div>
    </div>

    <!-- AI Assistant Floating Button -->
    <button id="chatbotButtonContainer" onclick="toggleChatbot()" style="position:fixed; right:30px; bottom:30px; z-index:9400; display:none; width:70px; height:70px; border-radius:50%; border:3px solid rgba(99,102,241,0.8); background:linear-gradient(135deg,#6366f1,#8b5cf6); box-shadow:0 10px 30px rgba(99,102,241,0.7), 0 0 0 0 rgba(99,102,241,0.9); cursor:pointer; align-items:center; justify-content:center; transition:all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); animation:chatbotBounce 2s ease-in-out infinite;" class="chatbot-button" onmouseover="this.style.transform='scale(1.2)'; this.style.boxShadow='0 15px 40px rgba(99,102,241,0.9)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 10px 30px rgba(99,102,241,0.7)'">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="transition: transform 0.3s ease;">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" fill="white"/>
            <circle cx="9" cy="10" r="1.5" fill="#6366f1"/>
            <circle cx="12" cy="10" r="1.5" fill="#6366f1"/>
            <circle cx="15" cy="10" r="1.5" fill="#6366f1"/>
        </svg>
    </button>

    <!-- AI Assistant Modal -->
    <div id="chatbotModal" style="display:none; position:fixed; right:20px; bottom:80px; z-index:9500; pointer-events:none;" class="ai-assistant-container">
        <div class="chatbot-modal" style="position:relative; margin:0; background:rgba(15,15,25,0.98); backdrop-filter:blur(20px) saturate(180%); -webkit-backdrop-filter:blur(20px) saturate(180%); border-radius:16px; padding:16px; box-shadow:0 20px 40px rgba(0,0,0,0.4); border:1px solid rgba(99,102,241,0.3); max-width:350px; width:350px; max-height:450px; display:none; z-index:9500; flex-direction:column; pointer-events:all;">
            <div class="modal-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; padding-bottom:10px; border-bottom:1px solid rgba(99,102,241,0.3);">
                <div style="display:flex; align-items:center; gap:10px;">
                    <div style="width:32px; height:32px; background:linear-gradient(135deg,#6366f1,#8b5cf6); border-radius:10px; display:flex; align-items: center; justify-content:center; box-shadow:0 4px 12px rgba(99,102,241,0.4);">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="white" opacity="0.9"/>
                            <path d="M2 17L12 22L22 17" stroke="white" stroke-width="2" stroke-linecap="round" opacity="0.9"/>
                            <path d="M2 12L12 17L22 12" stroke="white" stroke-width="2" stroke-linecap="round" opacity="0.9"/>
                        </svg>
                    </div>
                    <span style="font-family: 'Space Grotesk', sans-serif; font-weight:600; font-size:14px; letter-spacing:0.3px; color:var(--text);">AI Assistant</span>
                </div>
                <button onclick="hideChatbot()" style="background:rgba(255,255,255,0.1); border:none; width:28px; height:28px; border-radius:50%; font-size:14px; cursor:pointer; color:var(--text-secondary); display:flex; align-items:center; justify-content:center; transition:all 0.3s;" onmouseover="this.style.background='rgba(239,68,68,0.2)'; this.style.color='#ef4444'" onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.color='var(--text-secondary)'">&times;</button>
            </div>
            <div id="chatbot-messages" style="flex:1; min-height:250px; max-height:280px; overflow-y:auto; margin-bottom:12px; padding:12px; background:rgba(255,255,255,0.03); border-radius:12px; border:1px solid rgba(255,255,255,0.1); scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.3) transparent;"></div>
            <div style="margin-top:10px; display:flex; gap:6px;">
                <input id="chatbot-input" placeholder="Ask me anything..." style="flex:1; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.05); font-size:13px; font-weight:400; color:var(--text); font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif; backdrop-filter:blur(10px); transition:all 0.3s ease;" />
                <button class="btn" onclick="sendChatbotMessage()" style="padding:10px 16px; border-radius:10px; background:linear-gradient(135deg,#6366f1,#8b5cf6); border:none; color:white; font-weight:500; cursor:pointer; transition:all 0.3s; box-shadow:0 4px 12px rgba(99,102,241,0.4); font-size:12px; font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(99,102,241,0.6)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(99,102,241,0.4)'">Send</button>
            </div>
        </div>
    </div>

    <style>
        @keyframes chatbotBounce {
            0%, 100% {
                transform: translateY(0);
                box-shadow: 0 10px 30px rgba(99,102,241,0.7), 0 0 0 0 rgba(99,102,241,0.9);
            }
            50% {
                transform: translateY(-10px);
                box-shadow: 0 15px 35px rgba(99,102,241,0.8), 0 0 0 20px rgba(99,102,241,0);
            }
        }
        
        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        #floatingChatbotBtn:hover svg {
            transform: scale(1.1);
        }

        /* Chat message styles */
        .chat-row {
            margin-bottom: 12px;
            padding: 10px 12px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.4;
        }

        .chat-row.user {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            margin-left: 20px;
            border-bottom-right-radius: 4px;
        }

        .chat-row.bot {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            margin-right: 20px;
            border-bottom-left-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Scrollbar styling for chat */
        #chatbot-messages::-webkit-scrollbar {
            width: 6px;
        }

        #chatbot-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        #chatbot-messages::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        #chatbot-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Quick action buttons in chat */
        .chat-actions {
            margin-top: 8px;
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .chat-actions button {
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .chat-actions button:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #chatbotModal {
                right: 10px !important;
                top: auto !important;
                bottom: 80px !important;
                transform: none !important;
            }
            
            .chatbot-modal {
                max-width: 280px !important;
                width: 280px !important;
            }
        }
    </style>

    <script>
        // Security: Input sanitization
        function sanitizeInput(input) {
            if (!input) return '';
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML;
        }
        
        // Security: Validate input patterns
        function validateInput(input, type) {
            if (!input) return false;
            
            switch(type) {
                case 'username':
                    return /^[a-zA-Z0-9_]{3,30}$/.test(input);
                case 'phone':
                    return /^07\d{8}$/.test(input);
                case 'password':
                    return input.length >= 6 && input.length <= 100;
                case 'text':
                    return input.length > 0 && input.length <= 500;
                default:
                    return true;
            }
        }
        
        // Security: Rate limiting for login attempts
        const loginAttempts = {
            count: 0,
            lastAttempt: 0,
            maxAttempts: 5,
            lockoutTime: 300000 // 5 minutes
        };
        
        function checkRateLimit() {
            const now = Date.now();
            if (loginAttempts.count >= loginAttempts.maxAttempts) {
                const timeSinceLastAttempt = now - loginAttempts.lastAttempt;
                if (timeSinceLastAttempt < loginAttempts.lockoutTime) {
                    const remainingTime = Math.ceil((loginAttempts.lockoutTime - timeSinceLastAttempt) / 1000);
                    throw new Error(`Too many login attempts. Please try again in ${remainingTime} seconds.`);
                } else {
                    loginAttempts.count = 0;
                }
            }
        }
        
        // API Base URL
        const API_BASE = window.location.origin + '/admin';
        console.log('API_BASE:', API_BASE);
        console.log('Current location:', window.location.href);
        
        // Current user data
        let currentUser = null;
        let authToken = null;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Admin Dashboard initializing...');
            console.log('API_BASE:', API_BASE);
            console.log('Current location:', window.location.href);
            
            // Load saved profile picture
            loadProfilePicture();
            
            // Fix avatar path - set correct src after DOM loads
            setTimeout(() => {
                const profilePic = document.getElementById('currentProfilePic');
                if (profilePic) {
                    profilePic.src = API_BASE + '/uploads/avatars/default-avatar.png';
                    profilePic.onerror = function() {
                        this.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
                        this.style.color = 'white';
                        this.style.fontSize = '24px';
                        this.style.display = 'flex';
                        this.style.alignItems = 'center';
                        this.style.justifyContent = 'center';
                        this.textContent = 'A';
                        this.removeAttribute('src');
                    };
                }
            }, 100);
            
            checkAuth();
            setupEventListeners();
        });
        
        function loadProfilePicture() {
            if (!currentUser) return;
            
            // Use user-specific key for profile picture
            const userKey = `profilePic_${currentUser.username || currentUser.id}`;
            const savedImage = localStorage.getItem(userKey);
            const savedPhone = currentUser.phone || localStorage.getItem('userPhone') || '0706757140';
            
            console.log('ðŸ–¼ï¸ Loading profile picture for:', currentUser.username, 'Key:', userKey, 'Has image:', !!savedImage);
            
            if (savedImage) {
                // Update top-right avatar
                const userAvatar = document.getElementById('userAvatar');
                if (userAvatar) {
                    userAvatar.style.backgroundImage = `url('${savedImage}')`;
                    userAvatar.style.backgroundSize = 'cover';
                    userAvatar.style.backgroundPosition = 'center';
                    userAvatar.style.backgroundRepeat = 'no-repeat';
                    userAvatar.textContent = ''; // Remove initial letter
                }
                
                // Update profile dropdown avatar
                const profileAvatarLarge = document.getElementById('profileAvatarLarge');
                if (profileAvatarLarge) {
                    profileAvatarLarge.style.backgroundImage = `url('${savedImage}')`;
                    profileAvatarLarge.style.backgroundSize = 'cover';
                    profileAvatarLarge.style.backgroundPosition = 'center';
                    profileAvatarLarge.style.backgroundRepeat = 'no-repeat';
                    profileAvatarLarge.textContent = ''; // Remove initial letter
                }
            } else {
                // No saved image - reset avatars to show initials
                console.log('âš ï¸ No profile picture found for:', currentUser.username);
                const displayName = currentUser.fullName || currentUser.full_name || currentUser.username || 'Admin';
                const initial = displayName.charAt(0).toUpperCase();
                
                const userAvatar = document.getElementById('userAvatar');
                if (userAvatar) {
                    userAvatar.style.backgroundImage = '';
                    userAvatar.textContent = initial;
                }
                
                const profileAvatarLarge = document.getElementById('profileAvatarLarge');
                if (profileAvatarLarge) {
                    profileAvatarLarge.style.backgroundImage = '';
                    profileAvatarLarge.textContent = initial;
                }
            }
            
            // Update phone number display
            const phoneDisplay = document.getElementById('profileDropdownPhone');
            if (phoneDisplay) {
                phoneDisplay.innerHTML = `<i class="fas fa-phone" style="font-size: 12px;"></i><span>${savedPhone}</span>`;
            }
        }

        function setupEventListeners() {
            // Login form - multiple event bindings to ensure it works
            const loginForm = document.getElementById('loginForm');
            const loginBtn = document.getElementById('loginBtn');
            
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleLogin(e);
                    return false;
                });
            }
            
            if (loginBtn) {
                loginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    handleLogin(e);
                    return false;
                });
                
                // Also handle mousedown
                loginBtn.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                });
            }
            
            // Enter key handling for inputs
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            if (usernameInput) {
                usernameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        handleLogin(e);
                    }
                });
            }
            
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        handleLogin(e);
                    }
                });
            }
            
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', handleNavigation);
            });
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            const loginError = document.getElementById('loginError');
            
            // Security: Input validation
            if (!validateInput(username, 'username')) {
                loginError.innerHTML = '<div class="error-message">Invalid username format. Use 3-30 alphanumeric characters.</div>';
                return;
            }
            
            if (!validateInput(password, 'password')) {
                loginError.innerHTML = '<div class="error-message">Invalid password length. Must be 6-100 characters.</div>';
                return;
            }
            
            // Security: Rate limiting
            try {
                checkRateLimit();
            } catch (error) {
                loginError.innerHTML = `<div class="error-message">${sanitizeInput(error.message)}</div>`;
                return;
            }
            
            loginBtn.innerHTML = '<div class="loading"></div> Signing In...';
            loginBtn.disabled = true;
            loginError.innerHTML = '';
            
            try {
                loginAttempts.count++;
                loginAttempts.lastAttempt = Date.now();
                
                console.log('Attempting login to:', `${API_BASE}/api/auth/login`);
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({ 
                        username: sanitizeInput(username), 
                        password: password 
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Login failed');
                }
                
                // Reset login attempts on success
                loginAttempts.count = 0;
                
                authToken = data.token;
                currentUser = data.user;
                
                // Store auth data with expiration
                const authData = {
                    token: authToken,
                    user: currentUser,
                    expires: Date.now() + (24 * 60 * 60 * 1000) // 24 hours
                };
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                localStorage.setItem('authExpiry', authData.expires.toString());
                
                showApp();
                loadDashboardData();
                
                // Show AI assistant button
                setTimeout(() => {
                    const chatbotContainer = document.getElementById('chatbotButtonContainer');
                    if (chatbotContainer) {
                        chatbotContainer.style.display = 'flex';
                    }
                }, 500);
                
            } catch (error) {
                loginError.innerHTML = `<div class="error-message">${sanitizeInput(error.message)}</div>`;
            } finally {
                loginBtn.innerHTML = '<span>Sign In</span>';
                loginBtn.disabled = false;
            }
        }

        function checkAuth() {
            const storedToken = localStorage.getItem('authToken');
            const storedUser = localStorage.getItem('currentUser');
            const authExpiry = localStorage.getItem('authExpiry');
            
            // Security: Check if auth is expired
            if (authExpiry && Date.now() > parseInt(authExpiry)) {
                console.log('Auth token expired, logging out...');
                logout();
                return;
            }
            
            if (storedToken && storedUser) {
                try {
                    authToken = storedToken;
                    currentUser = JSON.parse(storedUser);
                    showApp();
                    loadDashboardData();
                    
                    // Show AI assistant button only after successful auth
                    setTimeout(() => {
                        const chatbotContainer = document.getElementById('chatbotButtonContainer');
                        if (chatbotContainer) {
                            chatbotContainer.style.display = 'flex';
                        }
                    }, 500);
                } catch (error) {
                    console.error('Error parsing stored user data:', error);
                    logout();
                }
            }
        }

        function showApp() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            
            // Update user info
            if (currentUser) {
                const displayName = currentUser.fullName || currentUser.full_name || currentUser.username || 'Admin';
                const userPhone = currentUser.phone || '+254700000000';
                
                const userNameEl = document.getElementById('userName');
                const userRoleEl = document.getElementById('userRole');
                const userPhoneEl = document.getElementById('userPhone');
                const userAvatarEl = document.getElementById('userAvatar');
                const profileDropdownNameEl = document.getElementById('profileDropdownName');
                const profileDropdownRoleEl = document.getElementById('profileDropdownRole');
                const profileDropdownPhoneEl = document.getElementById('profileDropdownPhone');
                const profileAvatarLargeEl = document.getElementById('profileAvatarLarge');
                
                if (userNameEl) userNameEl.textContent = displayName;
                if (userRoleEl) userRoleEl.textContent = currentUser.role || 'User';
                if (userPhoneEl) userPhoneEl.textContent = userPhone;
                if (userAvatarEl) userAvatarEl.textContent = displayName.charAt(0).toUpperCase();
                if (profileDropdownNameEl) profileDropdownNameEl.textContent = displayName;
                if (profileDropdownRoleEl) profileDropdownRoleEl.textContent = currentUser.role || 'User';
                if (profileDropdownPhoneEl) profileDropdownPhoneEl.innerHTML = `<i class="fas fa-phone" style="font-size: 12px;"></i><span>${userPhone}</span>`;
                if (profileAvatarLargeEl) profileAvatarLargeEl.textContent = displayName.charAt(0).toUpperCase();
                
                // Load user-specific profile picture
                loadProfilePicture();
            }
            
            // Set default page to dashboard
            setActivePage('dashboard');
            showPageContent('dashboard');
            
            // Show AI Assistant after successful login
            setTimeout(() => {
                const chatbotContainer = document.getElementById('chatbotButtonContainer');
                if (chatbotContainer) {
                    chatbotContainer.style.display = 'flex';
                    console.log('AI Assistant button shown after login');
                }
            }, 500);
        }

        function handleNavigation(e) {
            e.preventDefault();
            
            const page = e.currentTarget.dataset.page;
            
            // Update active nav item
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            e.currentTarget.classList.add('active');
            
            // Update page title and breadcrumb
            const pageTitle = e.currentTarget.querySelector('.nav-text').textContent;
            document.getElementById('pageTitle').textContent = pageTitle;
            document.getElementById('breadcrumbCurrent').textContent = pageTitle;
            
            // Show appropriate content
            showPageContent(page);
        }

        function showPageContent(page) {
            // Hide all page contents
            document.querySelectorAll('.page-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show selected page content
            const pageContent = document.getElementById(`${page}Content`);
            if (pageContent) {
                pageContent.style.display = 'block';
            }
            
            // Load page-specific data
            switch (page) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'issues':
                    loadIssuesData();
                    break;
                case 'bursaries':
                    loadBursariesData();
                    break;
                case 'settings':
                    loadSettingsData();
                    break;
                case 'announcements':
                    loadAnnouncementsData();
                    break;
                case 'users':
                    loadUsersData();
                    break;
                case 'constituents':
                    loadConstituentsData();
                    break;
                case 'ussd':
                    refreshUssdData();
                    break;
                // Add more cases as needed
            }
        }
        
        function setActivePage(page) {
            // Update navigation active state
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === page) {
                    link.classList.add('active');
                    
                    // Update page title and breadcrumb
                    const pageTitle = link.querySelector('.nav-text').textContent;
                    const titleElement = document.getElementById('pageTitle');
                    const breadcrumbElement = document.getElementById('breadcrumbCurrent');
                    
                    if (titleElement) titleElement.textContent = pageTitle;
                    if (breadcrumbElement) breadcrumbElement.textContent = pageTitle;
                }
            });
        }

        async function loadDashboardData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (!response.ok) throw new Error('Failed to load stats');
                
                const stats = await response.json();
                
                // Update stat cards
                document.getElementById('totalIssues').textContent = stats.totalIssues || 0;
                document.getElementById('totalBursaries').textContent = stats.totalBursaries || 0;
                document.getElementById('totalConstituents').textContent = stats.totalConstituents || 0;
                document.getElementById('totalUssd').textContent = stats.totalUssd || 0;
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function loadIssuesData() {
            // Implement issues data loading
            console.log('Loading issues data...');
        }

        function loadBursariesData() {
            // Implement bursaries data loading
            console.log('Loading bursaries data...');
        }

        function navigateTo(page) {
            const navLink = document.querySelector(`[data-page="${page}"]`);
            if (navLink) {
                navLink.click();
            }
        }

        function logout() {
            // Close any open dropdowns
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown) dropdown.style.display = 'none';
            
            // Show logout confirmation
            showToast('Signing out...', 'info');
            
            // Security: Clear all auth data
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            localStorage.removeItem('authExpiry');
            authToken = null;
            currentUser = null;
            
            // Hide app and show login
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            
            // Hide AI Assistant completely on logout
            const chatbotContainer = document.getElementById('chatbotButtonContainer');
            const chatbotModal = document.getElementById('chatbotModal');
            if (chatbotContainer) chatbotContainer.style.display = 'none';
            if (chatbotModal) chatbotModal.style.display = 'none';
            
            // Clear login form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            // Show success message
            setTimeout(() => {
                showToast('Successfully signed out', 'success');
            }, 300);
        }

        // ========================================
        // AI ASSISTANT FUNCTIONALITY
        // ========================================
        function showChatbot() {
            const modal = document.getElementById('chatbotModal');
            const panel = document.querySelector('.chatbot-modal');
            
            modal.style.display = 'block';
            if (panel) {
                panel.style.display = 'flex';
                panel.style.transform = 'translateY(20px)';
                panel.style.opacity = '0';
                
                setTimeout(() => {
                    panel.style.transform = 'translateY(0)';
                    panel.style.opacity = '1';
                    panel.style.transition = 'all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)';
                }, 10);
            }

            const convo = document.getElementById('chatbot-messages');
            if (!convo.children.length) {
                appendChatMessage('bot', 'Hello! I can guide you through using this admin dashboard. Try: "how to resolve issues", "export data", "change password", or "check database status".');
            }
        }

        function toggleChatbot() {
            const modal = document.getElementById('chatbotModal');
            const panel = document.querySelector('.chatbot-modal');
            
            if (!modal || !panel) {
                console.error('Chatbot elements not found');
                return;
            }
            
            modal.style.display = 'flex';
            
            if (panel.style.display === 'none' || !panel.style.display) {
                panel.style.display = 'flex';
                const input = document.getElementById('chatbot-input');
                if (input) {
                    input.focus();
                    input.onkeydown = function(e) { 
                        if (e.key === 'Enter') { 
                            e.preventDefault(); 
                            sendChatbotMessage(); 
                        } 
                    };
                }
                // Show floating button
                document.getElementById('floatingChatbotBtn').style.display = 'flex';
            } else {
                panel.style.display = 'none';
                const input = document.getElementById('chatbot-input');
                if (input) input.onkeydown = null;
            }
        }

        function hideChatbot() {
            const modal = document.getElementById('chatbotModal');
            const panel = document.querySelector('.chatbot-modal');
            
            if (panel) {
                panel.style.transform = 'translateY(20px)';
                panel.style.opacity = '0';
                panel.style.transition = 'all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)';
                
                setTimeout(() => {
                    panel.style.display = 'none';
                    modal.style.display = 'none';
                }, 300);
            }
            
            const input = document.getElementById('chatbot-input');
            if (input) input.onkeydown = null;
        }

        function appendChatMessage(who, text) {
            const container = document.getElementById('chatbot-messages');
            const messageEl = document.createElement('div');
            messageEl.className = 'chat-row ' + (who === 'bot' ? 'bot' : 'user');
            
            if (who === 'bot') {
                text = formatMaiReply(text);
            }
            
            messageEl.innerHTML = text.replace(/</g,'&lt;').replace(/>/g,'&gt;');
            container.appendChild(messageEl);

            // Add action buttons for bot messages
            if (who === 'bot') {
                attachActionButtons(messageEl, text);
            }

            container.scrollTop = container.scrollHeight;
        }

        function formatMaiReply(text) {
            if (!text) return text;
            try {
                if (/â€”\s*Mai$|\-\s*Mai$|Mai\s*$/i.test(text.trim())) return text;
                return text + ' â€” Mai';
            } catch (e) { 
                return text; 
            }
        }

        function attachActionButtons(containerEl, text) {
            const t = (text || '').toLowerCase();
            const actions = [];
            
            if (t.includes('resolve') || t.includes('issues')) {
                actions.push({ label: 'Open Issues', fn: () => navigateTo('issues') });
            }
            if (t.includes('export')) {
                actions.push({ label: 'Export', fn: () => showToast('Export feature coming soon!', 'info') });
            }
            if (t.includes('ussd')) {
                actions.push({ label: 'Open USSD', fn: () => navigateTo('ussd') });
            }
            if (t.includes('password')) {
                actions.push({ label: 'Settings', fn: () => navigateTo('settings') });
            }
            if (t.includes('database') || t.includes('connectivity')) {
                actions.push({ label: 'Check DB', fn: () => checkDatabaseConnectivity() });
            }

            if (!actions.length) return;

            const wrapper = document.createElement('div');
            wrapper.className = 'chat-actions';

            actions.forEach(action => {
                const button = document.createElement('button');
                button.textContent = action.label;
                button.onclick = (e) => { 
                    e.stopPropagation(); 
                    action.fn(); 
                };
                wrapper.appendChild(button);
            });

            containerEl.appendChild(wrapper);
        }

        async function sendChatbotMessage() {
            const input = document.getElementById('chatbot-input');
            const text = (input.value || '').trim();
            if (!text) return;
            
            appendChatMessage('user', text);
            input.value = '';
            
            // AI Assistant Demo Mode - works without authentication
            try {
                let response = getAIResponse(text);
                appendChatMessage('bot', response);
                
            } catch (error) {
                console.error('AI Assistant error:', error);
                const fallbackResponse = getFallbackResponse(text.toLowerCase());
                appendChatMessage('bot', fallbackResponse);
            }
        }

        function getAIResponse(userMessage) {
            const query = userMessage.toLowerCase();
            
            // Comprehensive AI responses for any topic
            if (query.includes('hello') || query.includes('hi') || query.includes('hey')) {
                return 'Hello! I\'m Mai, your intelligent assistant. I can help you with anything - from dashboard navigation to general questions about technology, science, business, or any topic you\'re curious about!';
            } else if (query.includes('weather')) {
                return 'I can help you understand weather patterns and climate! For current local weather, I\'d recommend checking a weather service. Is there something specific about meteorology you\'d like to know?';
            } else if (query.includes('cook') || query.includes('recipe')) {
                return 'I\'d love to help with cooking! What type of dish are you interested in making? I can suggest recipes, cooking techniques, or explain culinary concepts.';
            } else if (query.includes('business') || query.includes('entrepreneur')) {
                return 'Great question about business! I can help with business strategy, entrepreneurship advice, market analysis, or administrative management. What specific aspect interests you?';
            } else if (query.includes('technology') || query.includes('programming') || query.includes('code')) {
                return 'Technology is fascinating! I can discuss programming languages, software development, emerging tech trends, or help explain technical concepts. What would you like to explore?';
            } else if (query.includes('health') || query.includes('fitness')) {
                return 'Health and wellness are important topics! I can provide general information about fitness, nutrition, or healthy habits. What specific health topic interests you?';
            } else if (query.includes('education') || query.includes('learn')) {
                return 'Learning is wonderful! I can help explain concepts from various subjects, suggest study strategies, or discuss educational topics. What would you like to learn about?';
            } else if (query.includes('dashboard') || query.includes('admin') || query.includes('system')) {
                return 'For this admin dashboard: Navigate using the sidebar, manage issues and bursaries, view analytics, and export data. I can also help with general system administration questions!';
            } else if (query.includes('issue') || query.includes('resolve') || query.includes('problem')) {
                return 'For issue management: Use the Issues section to view, update status, and resolve constituent problems. I can also help with general problem-solving approaches!';
            } else if (query.includes('export') || query.includes('data') || query.includes('download')) {
                return 'Data export: Navigate to any section (Issues, Bursaries, etc.) and use export functions. I can also explain data management best practices!';
            } else if (query.includes('password') || query.includes('security')) {
                return 'For security: Change passwords in Settings, use strong authentication. I can also discuss cybersecurity best practices and digital safety!';
            } else if (query.includes('database') || query.includes('connect') || query.includes('mongodb')) {
                return 'Database connectivity: Check Settings â†’ System Status for real-time DB status. I can also explain database concepts and data management!';
            } else if (query.includes('science') || query.includes('physics') || query.includes('chemistry')) {
                return 'Science is amazing! I can help explain scientific concepts, discuss research, or answer questions about physics, chemistry, biology, and more. What interests you?';
            } else if (query.includes('art') || query.includes('creative') || query.includes('design')) {
                return 'Creativity and art are wonderful! I can discuss artistic techniques, design principles, creative processes, or any artistic topic. What would you like to explore?';
            } else if (query.includes('history') || query.includes('culture')) {
                return 'History and culture are rich topics! I can discuss historical events, cultural phenomena, social developments, or answer questions about any time period or culture.';
            } else if (query.includes('help') || query.includes('what can you do')) {
                return 'I\'m a comprehensive AI assistant! I can help with:\nâ€¢ Dashboard navigation and system features\nâ€¢ Technology and programming questions\nâ€¢ Business and entrepreneurship advice\nâ€¢ Science and educational topics\nâ€¢ Creative and artistic discussions\nâ€¢ General knowledge on virtually any subject\n\nJust ask me anything you\'re curious about!';
            } else {
                // Smart contextual responses for any topic
                return `That\'s an interesting question about "${userMessage}"! I\'d be happy to help you explore this topic. Could you tell me more specifically what you\'d like to know? I can provide information, explanations, or discuss different aspects of this subject.`;
            }
        }

        function getFallbackResponse(query) {
            if (query.includes('issue') || query.includes('resolve')) {
                return 'To manage issues, click on "Issues" in the sidebar. You can view, update status, and resolve reported problems from constituents.';
            } else if (query.includes('export') || query.includes('download')) {
                return 'You can export data by navigating to the relevant section (Issues, Bursaries, etc.) and using the export functionality.';
            } else if (query.includes('password') || query.includes('change')) {
                return 'To change your password, go to Settings in the sidebar and use the password change form.';
            } else if (query.includes('database') || query.includes('connect')) {
                return 'Database connectivity can be checked through the system status. All data is stored securely in MongoDB Atlas.';
            } else if (query.includes('help')) {
                return 'I can help with: managing issues, exporting data, changing passwords, checking system status, and navigating the dashboard.';
            } else {
                return 'I can help you with dashboard navigation, issue management, data export, and system settings. What would you like to know?';
            }
        }

        // ========================================
        // DATABASE CONNECTIVITY CHECK
        // ========================================
        async function checkDatabaseConnectivity() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/health`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (!response.ok) {
                    throw new Error('Health check failed');
                }
                
                const health = await response.json();
                
                if (health.database === 'connected') {
                    appendChatMessage('bot', 'âœ… Database connectivity is healthy! MongoDB Atlas connection is active and all systems are operational.');
                } else {
                    appendChatMessage('bot', 'âš ï¸ Database connectivity issue detected. Please check system status or contact support.');
                }
                
            } catch (error) {
                appendChatMessage('bot', 'âŒ Unable to check database connectivity at the moment. Please try again later.');
                console.error('Database check error:', error);
            }
        }

        // ========================================
        // PROFILE & SETTINGS MANAGEMENT
        // ========================================
        
        async function loadSettingsData() {
            try {
                // Load current user profile data
                if (currentUser) {
                    document.getElementById('fullNameInput').value = currentUser.fullName || '';
                    document.getElementById('emailInput').value = currentUser.email || '';
                    document.getElementById('phoneInput').value = currentUser.phone || '';
                    document.getElementById('roleInput').value = currentUser.role || 'Administrator';
                    
                    // Load profile picture if available
                    if (currentUser.profilePicture) {
                        document.getElementById('currentProfilePic').src = currentUser.profilePicture;
                    }
                }
                
                // Check system status
                refreshSystemStatus();
                
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        function uploadProfilePicture(input) {
            const file = input.files[0];
            if (!file) return;

            // Validate file
            if (!file.type.match(/image\/(jpeg|jpg|png|gif|webp)/)) {
                showToast('Please select a valid image file (JPG, PNG, GIF, or WEBP).', 'error');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                showToast('File size must be less than 5MB.', 'error');
                return;
            }

            // Read file and convert to base64
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                
                // Update top-right avatar
                const userAvatar = document.getElementById('userAvatar');
                
                if (userAvatar) {
                    userAvatar.style.backgroundImage = `url('${imageUrl}')`;
                    userAvatar.style.backgroundSize = 'cover';
                    userAvatar.style.backgroundPosition = 'center';
                    userAvatar.textContent = ''; // Remove initial letter
                }
                
                // Save to localStorage with user-specific key
                const userKey = `profilePic_${currentUser.username || currentUser.id}`;
                localStorage.setItem(userKey, imageUrl);
                
                showToast('Profile picture updated successfully!', 'success');
                
                // Close dropdown
                const dropdown = document.getElementById('profileDropdown');
                if (dropdown) dropdown.style.display = 'none';
            };
            
            reader.onerror = function() {
                showToast('Failed to read image file. Please try again.', 'error');
            };
            
            reader.readAsDataURL(file);
        }

        async function updateProfile() {
            const updateBtn = document.getElementById('updateProfileBtn');
            
            const profileData = {
                fullName: document.getElementById('fullNameInput').value.trim(),
                email: document.getElementById('emailInput').value.trim(),
                phone: document.getElementById('phoneInput').value.trim()
            };

            // Basic validation
            if (!profileData.fullName) {
                showToast('Full name is required', 'error');
                return;
            }

            if (profileData.email && !validateEmail(profileData.email)) {
                showToast('Please enter a valid email address', 'error');
                return;
            }

            updateBtn.innerHTML = '<div class="loading"></div> Updating...';
            updateBtn.disabled = true;

            try {
                const response = await fetch(`${API_BASE}/api/admin/profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(profileData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Update failed');
                }

                const result = await response.json();
                
                // Update stored user data
                if (currentUser) {
                    Object.assign(currentUser, profileData);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Update header display
                    document.getElementById('userName').textContent = profileData.fullName || currentUser.username;
                }

                showToast('Profile updated successfully!', 'success');

            } catch (error) {
                console.error('Update error:', error);
                showToast(error.message, 'error');
            } finally {
                updateBtn.innerHTML = '<i class="fas fa-save"></i> <span>Update Profile</span>';
                updateBtn.disabled = false;
            }
        }

        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const changeBtn = document.getElementById('changePasswordBtn');

            // Validation
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('All password fields are required', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showToast('New passwords do not match', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showToast('New password must be at least 6 characters long', 'error');
                return;
            }

            changeBtn.innerHTML = '<div class="loading"></div> Changing...';
            changeBtn.disabled = true;

            try {
                const response = await fetch(`${API_BASE}/api/admin/change-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        currentPassword,
                        newPassword
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Password change failed');
                }

                // Clear password fields
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';

                showToast('Password changed successfully!', 'success');

            } catch (error) {
                console.error('Password change error:', error);
                showToast(error.message, 'error');
            } finally {
                changeBtn.innerHTML = '<i class="fas fa-lock"></i> <span>Change Password</span>';
                changeBtn.disabled = false;
            }
        }

        async function refreshSystemStatus() {
            const indicator = document.getElementById('dbStatusIndicator');
            const statusText = document.getElementById('dbStatusText');
            const refreshBtn = document.getElementById('refreshStatusBtn');

            refreshBtn.innerHTML = '<div class="loading"></div> Checking...';
            refreshBtn.disabled = true;
            statusText.textContent = 'Checking...';
            indicator.style.background = 'var(--warning)';

            try {
                const response = await fetch(`${API_BASE}/api/admin/health`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) {
                    throw new Error('Health check failed');
                }

                const health = await response.json();
                
                if (health.database === 'connected') {
                    indicator.style.background = 'var(--success)';
                    statusText.textContent = `Connected (${health.details.collections} collections, ${health.details.latency}ms)`;
                } else {
                    indicator.style.background = 'var(--error)';
                    statusText.textContent = 'Disconnected';
                }

            } catch (error) {
                console.error('System status error:', error);
                indicator.style.background = 'var(--error)';
                statusText.textContent = 'Error checking status';
            } finally {
                refreshBtn.innerHTML = '<i class="fas fa-refresh"></i> <span>Refresh Status</span>';
                refreshBtn.disabled = false;
            }
        }

        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 20px;
                border-radius: 12px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                max-width: 300px;
                animation: slideInRight 0.3s ease;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            `;

            // Set background based on type
            switch (type) {
                case 'success':
                    toast.style.background = 'linear-gradient(135deg, var(--success), #059669)';
                    break;
                case 'error':
                    toast.style.background = 'linear-gradient(135deg, var(--error), #dc2626)';
                    break;
                case 'warning':
                    toast.style.background = 'linear-gradient(135deg, var(--warning), #d97706)';
                    break;
                default:
                    toast.style.background = 'linear-gradient(135deg, var(--primary), var(--primary-dark))';
            }

            toast.textContent = message;
            document.body.appendChild(toast);

            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 5000);
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // ========================================
        // ANNOUNCEMENTS MANAGEMENT
        // ========================================
        
        async function loadAnnouncementsData() {
            await loadAnnouncements();
            await refreshNewsPreview();
        }

        async function loadAnnouncements() {
            const container = document.getElementById('announcementsList');
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/announcements`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) {
                    throw new Error('Failed to load announcements');
                }

                const announcements = await response.json();
                
                if (announcements.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-bullhorn" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 8px;">No Announcements Yet</h3>
                            <p>Create your first ward announcement to get started.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = announcements.map(announcement => `
                    <div class="announcement-item" style="border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 16px; background: rgba(255,255,255,0.02);">
                        <div style="display: flex; justify-content: between; align-items: start; gap: 16px;">
                            <div style="flex: 1;">
                                <h4 style="margin-bottom: 8px; font-weight: 600; color: var(--text);">
                                    ${announcement.title || 'Ward Announcement'}
                                </h4>
                                <p style="margin-bottom: 12px; color: var(--text-secondary); line-height: 1.5;">
                                    ${announcement.body || announcement.content || 'No content'}
                                </p>
                                <div style="display: flex; gap: 16px; font-size: 14px; color: var(--text-muted);">
                                    <span><i class="fas fa-calendar"></i> ${new Date(announcement.created_at).toLocaleDateString()}</span>
                                    <span><i class="fas fa-user"></i> ${announcement.created_by || 'Admin'}</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn" onclick="editAnnouncement('${announcement._id}')" style="padding: 8px 12px; font-size: 12px;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn" onclick="deleteAnnouncement('${announcement._id}')" style="padding: 8px 12px; font-size: 12px; background: var(--error);">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error loading announcements:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--error);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 16px;"></i>
                        <h3>Error Loading Announcements</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function refreshNewsPreview() {
            const previewContainer = document.getElementById('ussdPreviewText');
            previewContainer.textContent = 'Loading preview...';

            try {
                const response = await fetch(`${API_BASE}/api/ussd/news/1`);
                const newsData = await response.json();

                previewContainer.textContent = newsData.message || 'No news available';

            } catch (error) {
                console.error('Error loading news preview:', error);
                previewContainer.textContent = 'Error loading preview: ' + error.message;
            }
        }

        function showNewAnnouncementModal() {
            // Open the existing announcement modal
            openModal('announcementModal');
        }

        function closeAnnouncementModal() {
            const modal = document.getElementById('announcementModal');
            if (modal) {
                modal.remove();
            }
        }

        async function createAnnouncement() {
            const title = document.getElementById('announcementTitle').value.trim();
            const content = document.getElementById('announcementContent').value.trim();
            const createBtn = document.getElementById('createAnnouncementBtn');

            if (!title || !content) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            createBtn.innerHTML = '<div class="loading"></div> Creating...';
            createBtn.disabled = true;

            try {
                const response = await fetch(`${API_BASE}/api/admin/announcements`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ title, body: content })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to create announcement');
                }

                showToast('Announcement created successfully!', 'success');
                closeAnnouncementModal();
                await loadAnnouncements();
                await refreshNewsPreview();

            } catch (error) {
                console.error('Error creating announcement:', error);
                showToast(error.message, 'error');
            } finally {
                createBtn.innerHTML = '<i class="fas fa-plus"></i> <span>Create Announcement</span>';
                createBtn.disabled = false;
            }
        }

        async function deleteAnnouncement(id) {
            if (!confirm('Are you sure you want to delete this announcement?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/admin/announcements/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (!response.ok) {
                    throw new Error('Failed to delete announcement');
                }

                showToast('Announcement deleted successfully!', 'success');
                await loadAnnouncements();
                await refreshNewsPreview();

            } catch (error) {
                console.error('Error deleting announcement:', error);
                showToast(error.message, 'error');
            }
        }

        // Smooth page transitions
        function addPageTransition() {
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => {
                page.style.transition = 'opacity 0.3s ease-in-out';
            });
        }

        // ========================================
        // MODAL AND BUTTON FUNCTIONALITY
        // ========================================
        
        // Show Add Issue Modal
        function showAddIssueModal() {
            document.getElementById('addIssueModal').style.display = 'flex';
            document.getElementById('issueTitle').focus();
        }
        
        // Show Process Bursary Modal
        function showProcessBursaryModal() {
            document.getElementById('processBursaryModal').style.display = 'flex';
            document.getElementById('applicantName').focus();
        }
        
        // Show Announcement Modal
        function showAnnouncementModal() {
            document.getElementById('announcementModal').style.display = 'flex';
            document.getElementById('announcementTitle').focus();
        }
        
        // Close Modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Reset forms
            const forms = document.getElementById(modalId).querySelectorAll('form');
            forms.forEach(form => form.reset());
        }
        
        // Submit New Issue
        async function submitNewIssue(event) {
            event.preventDefault();
            
            const formData = {
                title: document.getElementById('issueTitle').value,
                description: document.getElementById('issueDescription').value,
                priority: document.getElementById('issuePriority').value,
                location: document.getElementById('issueLocation').value,
                status: 'new',
                created_at: new Date().toISOString(),
                created_by: currentUser?.username || 'admin'
            };
            
            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                showToast('Issue added successfully!', 'success');
                closeModal('addIssueModal');
                loadIssuesData();
                
            } catch (error) {
                console.error('Error adding issue:', error);
                showToast('Failed to add issue. Please try again.', 'error');
            }
        }
        
        // Submit Bursary Decision
        async function submitBursaryDecision(event) {
            event.preventDefault();
            
            const formData = {
                applicantName: document.getElementById('applicantName').value,
                applicationId: document.getElementById('applicationId').value,
                amount: document.getElementById('bursaryAmount').value,
                decision: document.getElementById('bursaryDecision').value,
                reason: document.getElementById('decisionReason').value,
                processed_at: new Date().toISOString(),
                processed_by: currentUser?.username || 'admin'
            };
            
            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                showToast(`Bursary application ${formData.decision} successfully!`, 'success');
                closeModal('processBursaryModal');
                loadBursariesData();
                
            } catch (error) {
                console.error('Error processing bursary:', error);
                showToast('Failed to process application. Please try again.', 'error');
            }
        }
        
        // Submit Announcement
        async function submitAnnouncement(event) {
            event.preventDefault();
            
            const formData = {
                title: document.getElementById('announcementTitle').value,
                body: document.getElementById('announcementMessage').value,
                type: document.getElementById('announcementType').value,
                sendSMS: document.getElementById('sendSMS').checked
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/announcements`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to send announcement');
                }
                
                showToast('Announcement sent successfully!', 'success');
                document.getElementById('announcementForm').reset();
                closeModal('announcementModal');
                if (typeof loadAnnouncementsData === 'function') loadAnnouncementsData();
                
            } catch (error) {
                console.error('Error sending announcement:', error);
                showToast(error.message || 'Failed to send announcement. Please try again.', 'error');
            }
        }
        
        // Update Issue Status
        async function submitIssueUpdate(event) {
            event.preventDefault();
            
            const issueId = document.getElementById('updateIssueId').value;
            const status = document.getElementById('issueStatus').value;
            const action_note = document.getElementById('issueActionNote').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/issues/${issueId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ status, action_note })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to update issue');
                }
                
                showToast('Issue status updated successfully!', 'success');
                document.getElementById('updateIssueForm').reset();
                closeModal('updateIssueModal');
                if (typeof loadIssuesData === 'function') loadIssuesData();
                
            } catch (error) {
                console.error('Error updating issue:', error);
                showToast(error.message || 'Failed to update issue. Please try again.', 'error');
            }
        }
        
        // Show Update Issue Modal
        function showUpdateIssueModal(issue) {
            document.getElementById('updateIssueId').value = issue.ticketNo || issue.ticket || issue.id;
            document.getElementById('issueTitle').value = issue.title;
            document.getElementById('issueStatus').value = issue.status || '';
            document.getElementById('issueActionNote').value = '';
            openModal('updateIssueModal');
        }
        
        // Load Users Data - User Management removed, function disabled
        async function loadUsersData() {
            const usersList = document.getElementById('usersList');
            const usersCount = document.getElementById('usersCount');
            
            // Check if user is authenticated
            if (!authToken) {
                console.error('No auth token available for loading users');
                if (usersList) {
                    usersList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 16px; color: #f59e0b;"></i>
                            <p>Please log in to view users</p>
                        </div>
                    `;
                }
                return;
            }
            
            try {
                console.log('Fetching users with token:', authToken ? 'Present' : 'Missing');
                // Try to fetch users from database
                const response = await fetch(`${API_BASE}/api/auth/users`, {
                    headers: { 
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const loadingEl = document.getElementById('usersLoading');
                if (loadingEl) loadingEl.style.display = 'none';
                
                if (response.ok) {
                    const users = await response.json(); // Backend returns array directly
                    
                    // Load user-specific profile pictures for each user
                    users.forEach(user => {
                        const userKey = `profilePic_${user.username || user.name || user.id}`;
                        const savedPic = localStorage.getItem(userKey);
                        if (savedPic) {
                            user.profilePicture = savedPic;
                        }
                        // Normalize user data structure
                        if (!user.full_name) {
                            user.full_name = user.name;
                        }
                        if (!user.phone && !user.username) {
                            user.username = user.name.toLowerCase();
                        }
                    });
                    
                    if (usersCount) usersCount.textContent = `${users.length}`;
                    displayUsers(users);
                    
                    console.log(`Loaded ${users.length} users from database`);
                } else if (response.status === 401) {
                    console.error('Unauthorized - token may be invalid or expired');
                    authToken = null;
                    localStorage.removeItem('authToken');
                    throw new Error('Session expired. Please log in again.');
                } else {
                    throw new Error(`Failed to load users: ${response.status}`);
                }
            } catch (error) {
                console.error('Error loading users:', error);
                const loadingEl = document.getElementById('usersLoading');
                if (loadingEl) loadingEl.style.display = 'none';
                
                // Show error message with retry
                if (usersList) {
                    usersList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 16px; color: #f59e0b;"></i>
                            <p>Unable to load users</p>
                            <p style="font-size: 14px; opacity: 0.7;">${error.message}</p>
                            <button onclick="loadUsersData()" class="btn" style="margin-top: 16px;">
                                <i class="fas fa-sync-alt"></i> Retry
                            </button>
                        </div>
                    `;
                }
                if (usersCount) usersCount.textContent = '0';
            }
        }
        
        // Display Users - Disabled (User Management removed)
        function displayUsers(users) {
            const usersList = document.getElementById('usersList');
            
            if (!users || users.length === 0) {
                usersList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-users" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                        <p>No users found</p>
                        <a href="signup.html" class="btn" style="margin-top: 16px;">
                            <i class="fas fa-user-plus"></i> Add First User
                        </a>
                    </div>
                `;
                return;
            }
            
            // Check if current user is MCA (can be 'MCA', 'mca', or 'super_admin')
            const currentUserRole = (currentUser?.role || '').toLowerCase();
            const isMCA = currentUserRole === 'mca' || currentUserRole === 'super_admin';
            
            const usersHtml = users.map(user => {
                const userRole = (user.role || '').toLowerCase();
                const isTargetUserMCA = userRole === 'mca' || userRole === 'super_admin';
                const canDeleteThisUser = isMCA && !isTargetUserMCA;
                
                // Normalize role display
                let roleDisplay = user.role;
                let roleBadgeColor = '#7C3AED';
                if (userRole === 'mca' || userRole === 'super_admin') {
                    roleDisplay = 'MCA';
                    roleBadgeColor = '#DC2626';
                } else if (userRole === 'admin' || userRole === 'pa') {
                    roleDisplay = 'PA';
                    roleBadgeColor = '#059669';
                } else if (userRole === 'clerk') {
                    roleDisplay = 'Clerk';
                    roleBadgeColor = '#7C3AED';
                }
                
                return `
                <div class="user-card" style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 16px; border: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <img src="${user.profilePicture || '/uploads/avatars/default-avatar.png'}" 
                             alt="${user.full_name || user.name || user.username}" 
                             style="width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--border); object-fit: cover;"
                             onerror="this.src='/uploads/avatars/default-avatar.png'">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 4px 0; color: var(--text);">${user.full_name || user.name || user.username}</h4>
                            <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">@${user.username || (user.name || '').toLowerCase()}</p>
                            <span style="display: inline-block; background: ${roleBadgeColor}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-top: 4px;">
                                ${roleDisplay} ${isTargetUserMCA ? '(Main Admin)' : ''}
                            </span>
                        </div>
                        <div style="text-align: right; color: var(--text-secondary); font-size: 14px;">
                            <div>Phone: ${user.phone || 'N/A'}</div>
                            <div>Joined: ${user.created_at ? new Date(user.created_at).toLocaleDateString() : 'N/A'}</div>
                            <div style="margin-top: 8px; display: flex; gap: 8px; justify-content: flex-end;">
                                ${canDeleteThisUser ? `
                                    <button onclick="confirmDeleteUser('${user.id || user._id}', '${user.username || user.name}', '${user.role}')" class="btn-delete" style="padding: 8px 12px; background: #DC2626; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='#B91C1C'" onmouseout="this.style.background='#DC2626'">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                ` : `
                                    <button disabled title="${isTargetUserMCA ? 'MCA cannot be deleted' : 'Only MCA can delete users'}" style="padding: 8px 12px; background: #374151; color: #6B7280; border: none; border-radius: 6px; cursor: not-allowed; font-size: 13px;">
                                        <i class="fas fa-lock"></i> ${isTargetUserMCA ? 'Protected' : 'No Access'}
                                    </button>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `}).join('');
            
            usersList.innerHTML = `
                <div style="margin-bottom: 20px; padding: 16px; background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px solid var(--border);">
                    <h4 style="margin: 0 0 8px 0; color: var(--text);">System Users (${users.length}/3)</h4>
                    <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">
                        ${isMCA ? 'âœ“ You have full access to manage users' : 'âš ï¸ Only MCA can delete users'}
                    </p>
                </div>
                ${usersHtml}
            `;
        }
        
        // Load Issues Data
        async function loadIssuesData() {
            console.log('Loading constituent issues data...');
            const issuesList = document.getElementById('issuesList');
            const issuesCount = document.getElementById('issuesCount');
            
            try {
                // Show loading state
                issuesList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ccc;">
                        <div style="margin-bottom: 16px; font-size: 24px;">â³</div>
                        <div>Loading constituent issues...</div>
                        <div style="margin-top: 8px; font-size: 12px; opacity: 0.7;">Fetching reported issues from database</div>
                    </div>
                `;
                
                // Simulate API call - in real implementation, this would fetch from your backend
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Mock data for demonstration
                const mockIssues = [
                    {
                        id: 'ISS-001',
                        ticketNo: 'VOO-2025-001',
                        title: 'Poor Road Condition on Kiambu Road',
                        description: 'The road has several potholes that make it difficult for vehicles to pass. Need urgent repair.',
                        category: 'Infrastructure',
                        priority: 'High',
                        status: 'pending',
                        reportedBy: 'John Kamau',
                        reporterPhone: '+254712345678',
                        location: 'Kiambu Road, Section A',
                        dateReported: new Date(Date.now() - 86400000 * 2).toISOString(),
                        assignedTo: null,
                        estimatedResolution: '7 days'
                    },
                    {
                        id: 'ISS-002',
                        ticketNo: 'VOO-2025-002',
                        title: 'Broken Street Light',
                        description: 'Street light not working for over a week. Creates safety concerns for pedestrians.',
                        category: 'Public Safety',
                        priority: 'Medium',
                        status: 'in-progress',
                        reportedBy: 'Mary Wanjiku',
                        reporterPhone: '+254798765432',
                        location: 'Main Street, Near Market',
                        dateReported: new Date(Date.now() - 86400000 * 5).toISOString(),
                        assignedTo: 'Technical Team',
                        estimatedResolution: '3 days'
                    },
                    {
                        id: 'ISS-003',
                        ticketNo: 'VOO-2025-003',
                        title: 'Water Supply Issue',
                        description: 'No water supply for 3 days in the residential area. Residents are facing difficulties.',
                        category: 'Utilities',
                        priority: 'Critical',
                        status: 'resolved',
                        reportedBy: 'Peter Mwangi',
                        reporterPhone: '+254723456789',
                        location: 'Residential Area Block C',
                        dateReported: new Date(Date.now() - 86400000 * 7).toISOString(),
                        assignedTo: 'Water Department',
                        estimatedResolution: 'Completed',
                        resolvedDate: new Date(Date.now() - 86400000 * 1).toISOString()
                    }
                ];
                
                displayIssues(mockIssues);
                updateIssueStats(mockIssues);
                
                if (issuesCount) {
                    issuesCount.textContent = `${mockIssues.length} issues reported`;
                }
                
                // Show success message
                showToast('Issues data loaded successfully', 'success');
                
            } catch (error) {
                console.error('Error loading issues:', error);
                issuesList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ff6b6b;">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">âš ï¸</div>
                        <div style="margin-bottom: 8px; font-size: 16px;">Failed to Load Issues</div>
                        <p style="font-size: 14px; opacity: 0.8;">${error.message}</p>
                        <button onclick="loadIssuesData()" style="margin-top: 16px; padding: 8px 16px; background: #6366f1; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            ðŸ”„ Try Again
                        </button>
                    </div>
                `;
                
                showToast('Failed to load issues data', 'error');
            }
        }
        
        function displayIssues(issues) {
            const issuesList = document.getElementById('issuesList');
            
            if (!issues || issues.length === 0) {
                issuesList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ccc;">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">ðŸ“‹</div>
                        <div style="margin-bottom: 8px; font-size: 16px;">No Issues Reported</div>
                        <p style="font-size: 14px; opacity: 0.8;">No constituent issues have been reported yet</p>
                        <button onclick="showAddIssueModal()" style="margin-top: 16px; padding: 8px 16px; background: #059669; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Report First Issue
                        </button>
                    </div>
                `;
                return;
            }
            
            const getStatusColor = (status) => {
                const colors = {
                    'pending': '#f59e0b',
                    'in-progress': '#3b82f6', 
                    'resolved': '#059669',
                    'closed': '#6b7280'
                };
                return colors[status] || '#6b7280';
            };
            
            const getPriorityColor = (priority) => {
                const colors = {
                    'Critical': '#dc2626',
                    'High': '#ea580c',
                    'Medium': '#d97706',
                    'Low': '#65a30d'
                };
                return colors[priority] || '#6b7280';
            };
            
            const issuesHtml = issues.map(issue => `
                <div class="issue-card" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 16px; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.06)'" onmouseout="this.style.background='rgba(255,255,255,0.03)'">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                        <div>
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <h3 style="color: #fff; margin: 0; font-size: 16px; font-weight: 600;">${issue.title}</h3>
                                <span style="background: ${getPriorityColor(issue.priority)}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 500;">${issue.priority}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 8px;">
                                <span style="color: #6366f1; font-weight: 500; font-size: 14px;">#{issue.ticketNo}</span>
                                <span style="color: #ccc; font-size: 12px;">ðŸ“ ${issue.location}</span>
                                <span style="color: #ccc; font-size: 12px;">ðŸ“‹ ${issue.category}</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <button onclick='showUpdateIssueModal(${JSON.stringify(issue).replace(/'/g, "&#39;")})' style="background: #6366f1; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                                <i class="fas fa-edit"></i> Update Status
                            </button>
                            <span style="background: ${getStatusColor(issue.status)}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; text-transform: uppercase;">
                                ${issue.status.replace('-', ' ')}
                            </span>
                        </div>
                    </div>                    <p style="color: #ccc; margin: 0 0 16px 0; font-size: 14px; line-height: 1.5;">${issue.description}</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; font-size: 12px;">
                        <div>
                            <div style="color: #aaa; margin-bottom: 4px;">Reported By</div>
                            <div style="color: #fff; font-weight: 500;">${issue.reportedBy}</div>
                            <div style="color: #ccc;">${issue.reporterPhone}</div>
                        </div>
                        <div>
                            <div style="color: #aaa; margin-bottom: 4px;">Date Reported</div>
                            <div style="color: #fff;">${new Date(issue.dateReported).toLocaleDateString()}</div>
                            <div style="color: #ccc;">${new Date(issue.dateReported).toLocaleDateString('en-US', {weekday: 'long'})}</div>
                        </div>
                        <div>
                            <div style="color: #aaa; margin-bottom: 4px;">${issue.status === 'resolved' ? 'Resolution Time' : 'Estimated Resolution'}</div>
                            <div style="color: #fff;">${issue.estimatedResolution}</div>
                            ${issue.assignedTo ? `<div style="color: #6366f1;">Assigned: ${issue.assignedTo}</div>` : '<div style="color: #f59e0b;">Unassigned</div>'}
                        </div>
                    </div>
                </div>
            `).join('');
            
            issuesList.innerHTML = issuesHtml;
        }
        
        function updateIssueStats(issues) {
            const pending = issues.filter(i => i.status === 'pending').length;
            const inProgress = issues.filter(i => i.status === 'in-progress').length;
            const resolved = issues.filter(i => i.status === 'resolved').length;
            
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('inProgressCount').textContent = inProgress;
            document.getElementById('resolvedCount').textContent = resolved;
        }
        
        function filterIssues(status) {
            // Update filter button states
            document.querySelectorAll('.status-filter').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = `rgba(${btn.dataset.status === 'all' ? '99, 102, 241' : btn.dataset.status === 'pending' ? '245, 158, 11' : btn.dataset.status === 'in-progress' ? '59, 130, 246' : btn.dataset.status === 'resolved' ? '5, 150, 105' : '107, 114, 128'}, 0.2)`;
            });
            
            const activeBtn = document.querySelector(`[data-status="${status}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.background = `rgba(${status === 'all' ? '99, 102, 241' : status === 'pending' ? '245, 158, 11' : status === 'in-progress' ? '59, 130, 246' : status === 'resolved' ? '5, 150, 105' : '107, 114, 128'}, 0.4)`;
            }
            
            // Filter logic would go here - for demo, just show message
            showToast(`Filtering by ${status} status`, 'info');
        }
        
        function showIssueActions(issueId) {
            showToast('Issue actions menu - Update status, Assign, View details', 'info');
        }
        
        // Load Bursaries Data
        function loadBursariesData() {
            const bursariesList = document.getElementById('bursariesList');
            if (bursariesList) {
                bursariesList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-graduation-cap" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                        <p>Bursary management system ready</p>
                        <button class="btn" onclick="showProcessBursaryModal()" style="margin-top: 16px;">
                            <i class="fas fa-graduation-cap"></i> Process Application
                        </button>
                    </div>
                `;
            }
        }
        
        // Load Announcements Data
        function loadAnnouncementsData() {
            const announcementsList = document.getElementById('announcementsList');
            if (announcementsList) {
                announcementsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-bullhorn" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                        <p>Announcements system ready</p>
                        <button class="btn" onclick="showAnnouncementModal()" style="margin-top: 16px;">
                            <i class="fas fa-bullhorn"></i> Send Announcement
                        </button>
                    </div>
                `;
            }
        }
        
        // Export Constituents
        function exportConstituents() {
            showToast('Export feature will be implemented soon!', 'info');
        }
        
        // Refresh USSD Data
        function refreshUssdData() {
            const ussdList = document.getElementById('ussdList');
            if (ussdList) {
                ussdList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-mobile-alt" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                        <p>USSD interactions tracking ready</p>
                        <p style="font-size: 14px; margin-top: 8px;">Real-time USSD data will appear here</p>
                    </div>
                `;
            }
            showToast('USSD data refreshed!', 'success');
        }
        
        // Load Constituents Data
        function loadConstituentsData() {
            const constituentsList = document.getElementById('constituentsList');
            if (constituentsList) {
                constituentsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-users" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                        <p>Constituents database ready</p>
                        <button class="btn" onclick="exportConstituents()" style="margin-top: 16px;">
                            <i class="fas fa-download"></i> Export Data
                        </button>
                    </div>
                `;
            }
        }

        addPageTransition();
        
        // ========================================
        // PROFILE DROPDOWN FUNCTIONALITY
        // ========================================
        
        function toggleProfileDropdown() {
            // Remove existing dropdown if any
            const existing = document.getElementById('profileDropdown');
            if (existing) {
                existing.remove();
                return;
            }
            
            // Create compact dropdown
            const dropdown = document.createElement('div');
            dropdown.id = 'profileDropdown';
            dropdown.style.cssText = `
                position: fixed !important;
                top: 70px !important;
                right: 20px !important;
                background: rgba(15, 15, 25, 0.98) !important;
                backdrop-filter: blur(20px) !important;
                border: 1px solid rgba(99, 102, 241, 0.3) !important;
                border-radius: 12px !important;
                padding: 8px !important;
                width: 200px !important;
                z-index: 2147483647 !important;
                box-shadow: 0 8px 32px rgba(0,0,0,0.4), 0 0 0 1px rgba(99,102,241,0.2) !important;
                pointer-events: auto !important;
                display: block !important;
                animation: dropdownFadeIn 0.15s ease-out !important;
            `;
            
            const userName = currentUser?.fullName || currentUser?.full_name || currentUser?.username || 'Admin';
            const userRole = currentUser?.role || 'User';
            const userPhone = localStorage.getItem('userPhone') || '0706757140';
            
            dropdown.innerHTML = `
                <div style="padding: 12px; border-bottom: 1px solid rgba(99, 102, 241, 0.2);">
                    <div style="color: #fff; font-weight: 600; font-size: 14px; margin-bottom: 2px;">${userName}</div>
                    <div style="color: #a78bfa; font-size: 11px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">${userRole}</div>
                </div>
                
                <div style="padding: 4px 0;">
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); document.getElementById('profilePictureInput').click(); const dropdown = document.getElementById('profileDropdown'); if(dropdown) dropdown.remove(); return false;" style="display: flex; align-items: center; padding: 8px 12px; color: rgba(255,255,255,0.9); text-decoration: none; border-radius: 6px; transition: all 0.15s ease; font-size: 13px;" onmouseover="this.style.background='rgba(99, 102, 241, 0.15)'" onmouseout="this.style.background='transparent'">
                        <i class="fas fa-camera" style="margin-right: 10px; width: 14px; font-size: 13px; color: #a78bfa;"></i>
                        <span>Upload Picture</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); showChangePhoneModal(); const dropdown = document.getElementById('profileDropdown'); if(dropdown) dropdown.remove(); return false;" style="display: flex; align-items: center; padding: 8px 12px; color: rgba(255,255,255,0.9); text-decoration: none; border-radius: 6px; transition: all 0.15s ease; font-size: 13px;" onmouseover="this.style.background='rgba(99, 102, 241, 0.15)'" onmouseout="this.style.background='transparent'">
                        <i class="fas fa-phone-alt" style="margin-right: 10px; width: 14px; font-size: 13px; color: #a78bfa;"></i>
                        <span>Change Phone</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); showChangePasswordModal(); const dropdown = document.getElementById('profileDropdown'); if(dropdown) dropdown.remove(); return false;" style="display: flex; align-items: center; padding: 8px 12px; color: rgba(255,255,255,0.9); text-decoration: none; border-radius: 6px; transition: all 0.15s ease; font-size: 13px;" onmouseover="this.style.background='rgba(99, 102, 241, 0.15)'" onmouseout="this.style.background='transparent'">
                        <i class="fas fa-key" style="margin-right: 10px; width: 14px; font-size: 13px; color: #a78bfa;"></i>
                        <span>Change Password</span>
                    </a>
                    <div style="height: 1px; background: rgba(99, 102, 241, 0.2); margin: 4px 8px;"></div>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); logout(); return false;" style="display: flex; align-items: center; padding: 8px 12px; color: #fca5a5; text-decoration: none; border-radius: 6px; transition: all 0.15s ease; font-size: 13px;" onmouseover="this.style.background='rgba(239, 68, 68, 0.15)'" onmouseout="this.style.background='transparent'">
                        <i class="fas fa-sign-out-alt" style="margin-right: 10px; width: 14px; font-size: 13px;"></i>
                        <span>Sign Out</span>
                    </a>
                </div>
            `;
            
            document.body.appendChild(dropdown);
            
            // Close when clicking outside
            setTimeout(() => {
                const closeHandler = (e) => {
                    if (!dropdown.contains(e.target) && !e.target.closest('.user-avatar')) {
                        dropdown.remove();
                        document.removeEventListener('click', closeHandler);
                    }
                };
                document.addEventListener('click', closeHandler);
            }, 100);
        }
        
        function closeDropdownOutside(event) {
            const dropdown = document.getElementById('profileDropdown');
            const profile = document.querySelector('.user-profile');
            
            if (!dropdown.contains(event.target) && !profile.contains(event.target)) {
                dropdown.style.display = 'none';
                document.removeEventListener('click', closeDropdownOutside);
            }
        }
        
        function showProfileModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 10000; backdrop-filter: blur(5px);
            `;
            
            const userPhone = currentUser?.phone || '+254700000000';
            const userEmail = currentUser?.email || 'No email provided';
            
            modal.innerHTML = `
                <div style="background: rgba(30,30,30,0.95); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 32px; max-width: 450px; width: 90%; backdrop-filter: blur(20px);">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #6366f1, #8b5cf6); margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 36px; font-weight: bold; color: white;">
                            ${(currentUser?.fullName || currentUser?.username || 'U').charAt(0).toUpperCase()}
                        </div>
                        <h2 style="color: #fff; margin: 0 0 8px 0; font-size: 24px;">${currentUser?.fullName || currentUser?.username || 'User'}</h2>
                        <p style="color: #ccc; margin: 0; font-size: 16px;">${currentUser?.role || 'User'}</p>
                    </div>
                    
                    <div style="color: #ccc; line-height: 1.6;">
                        <div style="display: flex; align-items: center; margin-bottom: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <i class="fas fa-phone" style="margin-right: 12px; width: 20px; color: #6366f1;"></i>
                            <span>${userPhone}</span>
                        </div>
                        
                        <div style="display: flex; align-items: center; margin-bottom: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <i class="fas fa-envelope" style="margin-right: 12px; width: 20px; color: #6366f1;"></i>
                            <span>${userEmail}</span>
                        </div>
                        
                        <div style="display: flex; align-items: center; margin-bottom: 20px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <i class="fas fa-user-tag" style="margin-right: 12px; width: 20px; color: #6366f1;"></i>
                            <span>Account Type: ${currentUser?.role || 'User'}</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button onclick="showProfilePictureModal(); this.closest('.modal').remove();" style="padding: 10px 20px; background: #6366f1; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
                            <i class="fas fa-camera" style="margin-right: 8px;"></i>Change Photo
                        </button>
                        <button onclick="this.closest('.modal').remove(); toggleProfileDropdown();" style="padding: 10px 20px; background: rgba(255,255,255,0.1); color: #ccc; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; font-size: 14px;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            // Close dropdown
            document.getElementById('profileDropdown').style.display = 'none';
        }
        
        function showProfilePictureModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 10000; backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="background: rgba(30,30,30,0.95); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 32px; max-width: 500px; width: 90%; backdrop-filter: blur(20px);">
                    <h2 style="color: #fff; margin: 0 0 20px 0; text-align: center;">
                        <i class="fas fa-camera" style="margin-right: 12px; color: #6366f1;"></i>
                        Upload Profile Picture
                    </h2>
                    
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div id="currentProfilePic" style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #6366f1, #8b5cf6); margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: bold; color: white;">
                            ${(currentUser?.fullName || currentUser?.username || 'U').charAt(0).toUpperCase()}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <input type="file" id="profilePicInput" accept="image/*" style="display: none;" onchange="handleProfilePicUpload(event)">
                        <div style="border: 2px dashed rgba(255,255,255,0.3); border-radius: 12px; padding: 32px; text-align: center; cursor: pointer; transition: all 0.3s ease;" onclick="document.getElementById('profilePicInput').click()" onmouseover="this.style.borderColor='rgba(99,102,241,0.6)'" onmouseout="this.style.borderColor='rgba(255,255,255,0.3)'">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: #6366f1; margin-bottom: 16px; display: block;"></i>
                            <p style="color: #ccc; margin: 0 0 8px 0; font-size: 16px;">Click to select a profile picture</p>
                            <p style="color: #aaa; margin: 0; font-size: 12px;">JPG, PNG, GIF up to 5MB</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button onclick="this.closest('.modal').remove();" style="padding: 12px 24px; background: rgba(255,255,255,0.1); color: #ccc; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; font-size: 14px;">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            // Close dropdown
            document.getElementById('profileDropdown').style.display = 'none';
        }
        
        function handleProfilePicUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Update all profile pictures
                    const imgSrc = e.target.result;
                    
                    // Update main profile avatar
                    const userAvatar = document.getElementById('userAvatar');
                    userAvatar.innerHTML = `<img src="${imgSrc}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                    
                    // Update dropdown avatar
                    const profileAvatarLarge = document.getElementById('profileAvatarLarge');
                    profileAvatarLarge.innerHTML = `<img src="${imgSrc}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                    
                    // Update preview in modal
                    const currentProfilePic = document.getElementById('currentProfilePic');
                    if (currentProfilePic) {
                        currentProfilePic.innerHTML = `<img src="${imgSrc}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                    }
                    
                    showToast('Profile picture updated successfully!', 'success');
                    
                    // Close modal after a delay
                    setTimeout(() => {
                        const modal = document.querySelector('.modal');
                        if (modal) modal.remove();
                    }, 1500);
                };
                reader.readAsDataURL(file);
            }
        }
        
        function showSettingsModal() {
            // Navigate to settings page instead
            setActivePage('settings');
            showPageContent('settings');
            
            // Close dropdown
            document.getElementById('profileDropdown').style.display = 'none';
            
            showToast('Navigated to Settings page', 'info');
        }
        
        function showChangePhoneModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 10000; backdrop-filter: blur(5px);
            `;
            
            const currentPhone = '0706757140';
            
            modal.innerHTML = `
                <div style="background: rgba(30,30,30,0.95); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 32px; max-width: 450px; width: 90%; backdrop-filter: blur(20px);">
                    <h2 style="color: #fff; margin: 0 0 20px 0; text-align: center;">
                        <i class="fas fa-phone-alt" style="margin-right: 12px; color: #6366f1;"></i>
                        Change Phone Number
                    </h2>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #ccc; margin-bottom: 8px; font-size: 14px;">Current Phone</label>
                        <input type="text" value="${currentPhone}" disabled style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #aaa; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; color: #ccc; margin-bottom: 8px; font-size: 14px;">New Phone Number</label>
                        <input type="tel" id="newPhoneInput" placeholder="0712345678" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff; font-size: 14px;">
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button onclick="updatePhone()" style="padding: 12px 24px; background: #6366f1; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">
                            <i class="fas fa-check" style="margin-right: 8px;"></i>Update Phone
                        </button>
                        <button onclick="this.closest('.modal').remove();" style="padding: 12px 24px; background: rgba(255,255,255,0.1); color: #ccc; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; font-size: 14px;">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            // Close dropdown
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown) dropdown.style.display = 'none';
        }
        
        function showChangePasswordModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 10000; backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="background: rgba(30,30,30,0.95); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 32px; max-width: 450px; width: 90%; backdrop-filter: blur(20px);">
                    <h2 style="color: #fff; margin: 0 0 20px 0; text-align: center;">
                        <i class="fas fa-key" style="margin-right: 12px; color: #6366f1;"></i>
                        Change Password
                    </h2>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; color: #ccc; margin-bottom: 8px; font-size: 14px;">Current Password</label>
                        <input type="password" id="currentPasswordInput" placeholder="Enter current password" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; color: #ccc; margin-bottom: 8px; font-size: 14px;">New Password</label>
                        <input type="password" id="newPasswordInput" placeholder="Enter new password" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; color: #ccc; margin-bottom: 8px; font-size: 14px;">Confirm New Password</label>
                        <input type="password" id="confirmPasswordInput" placeholder="Confirm new password" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff; font-size: 14px;">
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button onclick="updatePassword()" style="padding: 12px 24px; background: #6366f1; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">
                            <i class="fas fa-check" style="margin-right: 8px;"></i>Change Password
                        </button>
                        <button onclick="this.closest('.modal').remove();" style="padding: 12px 24px; background: rgba(255,255,255,0.1); color: #ccc; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; font-size: 14px;">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            // Close dropdown
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown) dropdown.style.display = 'none';
        }
        
        function updatePhone() {
            const newPhone = document.getElementById('newPhoneInput').value.trim();
            
            if (!newPhone) {
                showToast('Please enter a phone number', 'error');
                return;
            }
            
            if (!/^07\d{8}$/.test(newPhone)) {
                showToast('Please enter a valid Kenyan phone number (07XXXXXXXX)', 'error');
                return;
            }
            
            // Update phone in UI
            const phoneDisplay = document.getElementById('profileDropdownPhone');
            if (phoneDisplay) {
                phoneDisplay.innerHTML = `<i class="fas fa-phone" style="margin-right: 6px;"></i>${newPhone}`;
            }
            
            // Save to localStorage
            localStorage.setItem('userPhone', newPhone);
            
            showToast('Phone number updated successfully!', 'success');
            
            // Close modal
            setTimeout(() => {
                const modal = document.querySelector('.modal');
                if (modal) modal.remove();
            }, 1000);
        }
        
        function updatePassword() {
            const currentPassword = document.getElementById('currentPasswordInput').value;
            const newPassword = document.getElementById('newPasswordInput').value;
            const confirmPassword = document.getElementById('confirmPasswordInput').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('New passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showToast('Password must be at least 6 characters long', 'error');
                return;
            }
            
            // In a real app, you would send this to the server
            showToast('Password changed successfully!', 'success');
            
            // Close modal
            setTimeout(() => {
                const modal = document.querySelector('.modal');
                if (modal) modal.remove();
            }, 1000);
        }
        
        // ========================================
        // USER MANAGEMENT FUNCTIONS
        // ========================================
        
        function confirmDeleteUser(userId, username, role) {
            if (currentUser?.role !== 'MCA') {
                showToast('Only MCA (Main Admin) can delete users', 'error');
                return;
            }
            
            if (role === 'MCA') {
                showToast('MCA (Main Admin) cannot be deleted', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 10000; backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="background: rgba(30,30,30,0.95); border: 1px solid rgba(220, 38, 38, 0.3); border-radius: 20px; padding: 32px; max-width: 450px; width: 90%; backdrop-filter: blur(20px);">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="width: 60px; height: 60px; border-radius: 50%; background: rgba(220, 38, 38, 0.2); margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; border: 2px solid #DC2626;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 24px; color: #DC2626;"></i>
                        </div>
                        <h2 style="color: #fff; margin: 0 0 8px 0; font-size: 20px;">Delete User Account</h2>
                        <p style="color: #ccc; margin: 0; font-size: 14px;">This action cannot be undone</p>
                    </div>
                    
                    <div style="background: rgba(220, 38, 38, 0.1); border: 1px solid rgba(220, 38, 38, 0.3); border-radius: 12px; padding: 16px; margin-bottom: 24px;">
                        <div style="color: #fff; font-weight: 500; margin-bottom: 8px;">User to be deleted:</div>
                        <div style="color: #f87171; font-size: 16px; font-weight: bold;">@${username}</div>
                        <div style="color: #ccc; font-size: 14px; margin-top: 4px;">Role: ${role}</div>
                    </div>
                    
                    <div style="color: #f87171; font-size: 14px; margin-bottom: 24px; text-align: center;">
                        âš ï¸ This will permanently remove the user's access to the admin dashboard
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button onclick="this.closest('.modal').remove();" style="padding: 12px 24px; background: rgba(255,255,255,0.1); color: #ccc; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; font-size: 14px;">
                            Cancel
                        </button>
                        <button onclick="deleteUser('${userId}'); this.closest('.modal').remove();" style="padding: 12px 24px; background: #DC2626; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">
                            <i class="fas fa-trash" style="margin-right: 8px;"></i>Delete User
                        </button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
        }
        
        async function deleteUser(userId) {
            if (currentUser?.role !== 'MCA') {
                showToast('Only MCA can delete users', 'error');
                return;
            }
            
            try {
                showToast('Deleting user...', 'info');
                
                const response = await fetch(`${API_BASE}/api/auth/users/${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.error || 'Failed to delete user');
                }
                
                showToast('User deleted successfully', 'success');
                
                // Reload users data
                setTimeout(() => {
                    loadUsersData();
                }, 500);
                
            } catch (error) {
                console.error('Error deleting user:', error);
                showToast('Failed to delete user: ' + error.message, 'error');
            }
        }
        
        async function editUser(userId) {
            showToast('Edit user functionality coming soon', 'info');
        }
    </script>
</body>
</html>